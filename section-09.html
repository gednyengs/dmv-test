<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CA DMV Practice Test -- Alcohol and Drugs</title>
<style>
*, *::before, *::after {
  box-sizing: border-box;
}

body {
  margin: 0;
  padding: 0;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
  background: #f5f7fa;
  color: #1a1a2e;
  line-height: 1.6;
}

#app {
  max-width: 800px;
  margin: 0 auto;
  padding: 16px;
}

/* Header */
header {
  text-align: center;
  margin-bottom: 16px;
}

header h1 {
  font-size: 1.5rem;
  margin: 0 0 12px 0;
  color: #003366;
}

#progress-bar-container {
  width: 100%;
  height: 8px;
  background: #dde1e7;
  border-radius: 4px;
  overflow: hidden;
  margin-bottom: 10px;
}

#progress-bar {
  height: 100%;
  width: 0%;
  background: linear-gradient(90deg, #2e7d32, #43a047);
  border-radius: 4px;
  transition: width 0.3s ease;
}

#score-display {
  display: flex;
  justify-content: center;
  gap: 12px;
  flex-wrap: wrap;
}

.score-chip {
  display: inline-block;
  padding: 4px 12px;
  border-radius: 16px;
  font-size: 0.85rem;
  font-weight: 600;
}

.correct-chip {
  background: #e8f5e9;
  color: #2e7d32;
}

.incorrect-chip {
  background: #ffebee;
  color: #c62828;
}

.unanswered-chip {
  background: #e3f2fd;
  color: #1565c0;
}

/* Filter bar */
#filter-bar {
  display: flex;
  gap: 10px;
  flex-wrap: wrap;
  align-items: center;
  margin-bottom: 20px;
  padding: 12px;
  background: #ffffff;
  border-radius: 8px;
  box-shadow: 0 1px 3px rgba(0,0,0,0.08);
}

.filter-group {
  display: flex;
  align-items: center;
  gap: 4px;
}

.filter-group label {
  font-size: 0.8rem;
  font-weight: 600;
  color: #555;
  white-space: nowrap;
}

.filter-group select {
  font-size: 0.85rem;
  padding: 4px 8px;
  border: 1px solid #ccc;
  border-radius: 4px;
  background: #fff;
  max-width: 180px;
}

#btn-shuffle, #btn-reset {
  font-size: 0.85rem;
  padding: 5px 14px;
  border: 1px solid #ccc;
  border-radius: 4px;
  background: #fff;
  cursor: pointer;
  font-weight: 600;
  color: #333;
  transition: background 0.2s;
}

#btn-shuffle:hover, #btn-reset:hover {
  background: #eee;
}

/* Question container */
#question-container {
  background: #ffffff;
  border-radius: 12px;
  padding: 24px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.08);
}

#question-meta {
  display: flex;
  align-items: center;
  gap: 10px;
  flex-wrap: wrap;
  margin-bottom: 16px;
}

#q-counter {
  font-weight: 700;
  font-size: 0.95rem;
  color: #003366;
}

.meta-tag {
  font-size: 0.75rem;
  padding: 2px 10px;
  border-radius: 12px;
  background: #e8eaf6;
  color: #283593;
  font-weight: 600;
}

/* Image */
#q-image-wrapper {
  text-align: center;
  margin-bottom: 16px;
}

#q-image {
  max-width: 100%;
  max-height: 360px;
  border-radius: 8px;
  border: 1px solid #ddd;
  object-fit: contain;
}

/* Question text */
#q-text {
  font-size: 1.1rem;
  font-weight: 500;
  margin-bottom: 20px;
  line-height: 1.5;
}

/* Choices */
#choices-container {
  display: flex;
  flex-direction: column;
  gap: 8px;
  margin-bottom: 20px;
}

.choice-btn {
  display: flex;
  align-items: flex-start;
  gap: 10px;
  width: 100%;
  padding: 12px 16px;
  border: 2px solid #dde1e7;
  border-radius: 8px;
  background: #fafbfc;
  cursor: pointer;
  text-align: left;
  font-size: 1rem;
  line-height: 1.4;
  transition: border-color 0.15s, background 0.15s;
}

.choice-btn:hover:not(:disabled) {
  border-color: #90caf9;
  background: #e3f2fd;
}

.choice-btn:disabled {
  cursor: default;
}

.choice-letter {
  font-weight: 700;
  color: #555;
  min-width: 24px;
  flex-shrink: 0;
}

.choice-text {
  flex: 1;
}

.choice-selected {
  border-color: #1976d2;
  background: #e3f2fd;
}

.choice-correct {
  border-color: #2e7d32 !important;
  background: #e8f5e9 !important;
}

.choice-correct .choice-letter {
  color: #2e7d32;
}

.choice-incorrect {
  border-color: #c62828 !important;
  background: #ffebee !important;
}

.choice-incorrect .choice-letter {
  color: #c62828;
}

/* Feedback */
#feedback {
  margin-bottom: 16px;
  padding: 12px 16px;
  border-radius: 8px;
  font-size: 0.95rem;
}

.feedback-correct {
  color: #2e7d32;
  font-weight: 700;
  font-size: 1.05rem;
}

.feedback-incorrect {
  color: #c62828;
  font-weight: 700;
  font-size: 1.05rem;
}

.feedback-neutral {
  color: #555;
  font-weight: 600;
}

#explanation {
  margin-top: 10px;
  padding: 12px 16px;
  background: #fff8e1;
  border-left: 4px solid #ffa000;
  border-radius: 4px;
  font-size: 0.95rem;
  line-height: 1.5;
}

/* Buttons */
#action-buttons {
  text-align: center;
  margin-bottom: 16px;
}

.btn-primary {
  padding: 10px 28px;
  font-size: 1rem;
  font-weight: 600;
  color: #fff;
  background: #1976d2;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  transition: background 0.2s;
  margin: 4px;
}

.btn-primary:hover {
  background: #1565c0;
}

#nav-buttons {
  display: flex;
  justify-content: space-between;
}

.btn-nav {
  padding: 10px 24px;
  font-size: 0.95rem;
  font-weight: 600;
  color: #333;
  background: #e0e0e0;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  transition: background 0.2s;
}

.btn-nav:hover:not(:disabled) {
  background: #bdbdbd;
}

.btn-nav:disabled {
  opacity: 0.4;
  cursor: default;
}

/* Summary */
#summary-container {
  background: #ffffff;
  border-radius: 12px;
  padding: 32px 24px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.08);
  text-align: center;
}

#summary-container h2 {
  color: #003366;
  margin-top: 0;
}

.summary-big-score {
  font-size: 2.5rem;
  font-weight: 800;
  color: #1a1a2e;
  margin: 16px 0 4px;
}

.summary-pct {
  font-size: 1.3rem;
  font-weight: 700;
  margin-bottom: 16px;
}

.summary-pass { color: #2e7d32; }
.summary-fail { color: #c62828; }

.summary-detail {
  margin-bottom: 24px;
}

.breakdown-table {
  width: 100%;
  border-collapse: collapse;
  margin: 16px 0 24px;
  font-size: 0.9rem;
  text-align: left;
}

.breakdown-table th {
  background: #e8eaf6;
  padding: 8px 12px;
  font-weight: 700;
  color: #283593;
}

.breakdown-table td {
  padding: 8px 12px;
  border-bottom: 1px solid #eee;
}

/* Empty state */
#empty-state {
  text-align: center;
  padding: 48px 24px;
  color: #777;
  font-size: 1.1rem;
}

/* Back link */
.back-link {
  display: inline-block;
  margin-bottom: 8px;
  font-size: 0.9rem;
  color: #1976d2;
  text-decoration: none;
  font-weight: 600;
}

.back-link:hover {
  text-decoration: underline;
}

/* Extra questions link */
.extra-link {
  display: block;
  text-align: center;
  margin-top: 24px;
  padding: 14px 24px;
  background: #ffffff;
  border: 2px solid #1976d2;
  border-radius: 12px;
  color: #1976d2;
  font-weight: 600;
  font-size: 1rem;
  text-decoration: none;
  transition: background 0.2s, color 0.2s;
}

.extra-link:hover {
  background: #1976d2;
  color: #ffffff;
}

/* Responsive */
@media (max-width: 600px) {
  #app { padding: 8px; }
  header h1 { font-size: 1.2rem; }
  #question-container { padding: 16px; }
  #q-text { font-size: 1rem; }
  .choice-btn { padding: 10px 12px; font-size: 0.95rem; }
  #filter-bar { gap: 6px; padding: 8px; }
  .filter-group select { max-width: 120px; }
  .summary-big-score { font-size: 2rem; }
}

</style>
</head>
<body>

<div id="app">
  <!-- Header -->
  <header id="header">
    <a href="index.html" class="back-link">&larr; All Sections</a>
    <h1>CA DMV Practice Test -- Alcohol and Drugs</h1>
    <div id="progress-bar-container">
      <div id="progress-bar"></div>
    </div>
    <div id="score-display">
      <span id="score-correct" class="score-chip correct-chip">Correct: 0</span>
      <span id="score-incorrect" class="score-chip incorrect-chip">Incorrect: 0</span>
      <span id="score-unanswered" class="score-chip unanswered-chip">Remaining: 0</span>
    </div>
  </header>

  <!-- Filter controls -->
  <div id="filter-bar">
    <div class="filter-group" style="display:none;">
      <label for="filter-section">Section:</label>
      <select id="filter-section"><option value="all">All Sections</option></select>
    </div>
    <div class="filter-group">
      <label for="filter-topic">Topic:</label>
      <select id="filter-topic"><option value="all">All Topics</option></select>
    </div>
    <div class="filter-group">
      <label for="filter-difficulty">Difficulty:</label>
      <select id="filter-difficulty"><option value="all">All</option></select>
    </div>
    <div class="filter-group">
      <label for="filter-type">Type:</label>
      <select id="filter-type"><option value="all">All</option></select>
    </div>
    <button id="btn-shuffle" title="Shuffle questions">Shuffle</button>
    <button id="btn-reset" title="Reset all answers">Reset</button>
  </div>

  <!-- Question slide -->
  <div id="question-container" style="display:none;">
    <div id="question-meta">
      <span id="q-counter">Question 1 of 1</span>
      <span id="q-section-label" class="meta-tag"></span>
      <span id="q-topic-label" class="meta-tag"></span>
      <span id="q-difficulty-label" class="meta-tag"></span>
    </div>

    <div id="q-image-wrapper" style="display:none;">
      <img id="q-image" alt="Question image" />
    </div>

    <div id="q-text"></div>

    <div id="choices-container"></div>

    <div id="feedback" style="display:none;">
      <div id="feedback-text"></div>
      <div id="explanation" style="display:none;"></div>
    </div>

    <div id="action-buttons">
      <button id="btn-show-answer" class="btn-primary">Show Answer</button>
    </div>

    <div id="nav-buttons">
      <button id="btn-prev" class="btn-nav" disabled>&larr; Previous</button>
      <button id="btn-next" class="btn-nav">Next &rarr;</button>
    </div>
  </div>

  <!-- Summary page -->
  <div id="summary-container" style="display:none;">
    <h2>Test Complete</h2>
    <div id="summary-score"></div>
    <div id="summary-breakdown"></div>
    <button id="btn-review" class="btn-primary">Review Answers</button>
    <button id="btn-restart" class="btn-primary">Restart</button>
  </div>

  <!-- Empty state -->
  <div id="empty-state" style="display:none;">
    <p>No questions match the current filters. Try adjusting your selection.</p>
  </div>

  <!-- Extra questions link -->
  <a href="section-09-extra.html" class="extra-link">Additional Practice Questions &rarr;</a>
</div>

<script>
'use strict';
(function() {

/* ---- Data ---- */
var ALL_QUESTIONS = JSON.parse('[{"question_id": "q-sec09-bac-limits-003", "question_type": "multiple_choice", "question_text": "What is the illegal BAC limit for drivers over 21 years old in California?", "choices": [{"label": "A", "text": "0.04% or higher"}, {"label": "B", "text": "0.05% or higher"}, {"label": "C", "text": "0.08% or higher"}, {"label": "D", "text": "0.10% or higher"}], "correct_answer": "C", "explanation": "In California, it is illegal to drive with a BAC of 0.08% or higher if you are over 21 years old. This is the standard legal limit for adult drivers.", "section_id": "section-09", "topic": "Blood Alcohol Concentration (BAC) Limits", "subtopic": "Illegal BAC Thresholds", "difficulty": "easy", "image_id": null, "image_file": null, "source_facts": ["It is illegal to drive with a BAC of 0.08% or higher if you are over 21 years old."], "validation_status": "pass", "_image_data_uri": null}, {"question_id": "q-sec09-dui-arrests-001", "question_type": "multiple_choice", "question_text": "When you drive in California, you automatically consent to which of the following tests if a law enforcement officer suspects you of DUI?", "choices": ["A. A vision test only", "B. A breath, blood, or urine test", "C. A field sobriety test only", "D. A polygraph test"], "correct_answer": "B", "explanation": "Under California\'s implied consent law, when you drive in California, you consent to a breath, blood, or urine test if a law enforcement officer suspects you of DUI. This is a condition of your driving privilege.", "section_id": "section-09", "topic": "DUI Arrests", "subtopic": "Implied Consent and Chemical Tests", "difficulty": "easy", "image_id": null, "image_file": null, "source_facts": ["When you drive in California, you consent to a breath, blood, or urine test if a law enforcement officer suspects you of DUI."], "validation_status": "pass", "validation_notes": null, "_image_data_uri": null}, {"question_id": "q-sec09-drivers-under-21-010", "question_type": "multiple_choice", "question_text": "If you are under 21 and convicted of a DUI with a BAC of 0.01% or higher, what may DMV do to your driving privilege?", "choices": ["A. Issue a warning letter", "B. Restrict your license to daytime driving only", "C. Revoke your driving privilege for one year", "D. Suspend your license for 6 months"], "correct_answer": "C", "explanation": "If you are under 21 and convicted of a DUI with a BAC of 0.01% or higher, DMV may revoke your driving privilege for one year. You must also complete a licensed DUI program.", "section_id": "section-09", "topic": "Drivers Under 21", "subtopic": "Consuming Alcohol: DUI Conviction at 0.01% BAC (Under 21)", "difficulty": "medium", "image_id": null, "image_file": null, "source_facts": ["If you are convicted of a DUI with a BAC of 0.01% or higher, DMV may revoke your driving privilege for one year (as stated here)."], "validation_status": "pass", "validation_notes": null, "_image_data_uri": null}, {"question_id": "q-sec09-alcohol-and-drugs-001", "question_type": "multiple_choice", "question_text": "California\'s driving under the influence (DUI) laws apply to which of the following?", "choices": [{"label": "A", "text": "Alcohol only"}, {"label": "B", "text": "Illegal drugs only"}, {"label": "C", "text": "Both alcohol and drugs"}, {"label": "D", "text": "Only drugs obtained without a prescription"}], "correct_answer": "C", "explanation": "California\'s DUI laws apply to both alcohol and drugs. Any substance that affects your ability to drive safely is covered, whether it is alcohol, an illegal drug, or a prescription medication.", "section_id": "section-09", "topic": "Alcohol and Drugs", "subtopic": "DUI Laws Apply to Alcohol and Drugs", "difficulty": "easy", "image_id": null, "image_file": null, "source_facts": ["California\'s driving under the influence (DUI) laws apply to both alcohol and drugs."], "validation_status": "pass", "validation_notes": null, "_image_data_uri": null}, {"question_id": "q-sec09-drivers-under-21-002", "question_type": "multiple_choice", "question_text": "If you are under 21, under what condition may you carry an alcohol beverage inside a vehicle?", "choices": ["A. If the alcohol is in a paper bag", "B. If an individual who is 21 years old or older is with you", "C. If you are driving to a licensed establishment", "D. If you have a valid learner\'s permit"], "correct_answer": "B", "explanation": "If you are under 21, you may not carry any alcohol beverage inside a vehicle unless an individual who is 21 years old or older is with you. Additionally, the container must be full, sealed, and unopened.", "section_id": "section-09", "topic": "Drivers Under 21", "subtopic": "Possessing Alcohol: Carrying Alcohol in a Vehicle", "difficulty": "medium", "image_id": null, "image_file": null, "source_facts": ["If you are under 21, you may not carry any alcohol beverage inside a vehicle unless an individual who is 21 years old or older is with you."], "validation_status": "pass", "validation_notes": null, "_image_data_uri": null}, {"question_id": "q-sec09-bac-limits-008", "question_type": "true_false", "question_text": "If your BAC is below the legal limit, it is always safe for you to drive.", "choices": [{"label": "True", "text": "True"}, {"label": "False", "text": "False"}], "correct_answer": "False", "explanation": "This is false. Even if your BAC is below legal limits, that does not mean it is safe for you to drive. Almost everyone feels negative effects of alcohol, even at levels lower than the legal limit.", "section_id": "section-09", "topic": "Blood Alcohol Concentration (BAC) Limits", "subtopic": "DUI Charges Even Below Legal Limits", "difficulty": "easy", "image_id": null, "image_file": null, "source_facts": ["A BAC below legal limits does not mean it is safe for you to drive."], "validation_status": "pass", "_image_data_uri": null}, {"question_id": "q-sec09-dui-convictions-010", "question_type": "multiple_choice", "question_text": "How long do all DUI convictions remain on your driver\'s record?", "choices": ["A. 3 years", "B. 5 years", "C. 7 years", "D. 10 years"], "correct_answer": "D", "explanation": "All DUI convictions remain on your driver\'s record for 10 years. If you get any other DUIs during that time, the court or DMV may give you an additional penalty.", "section_id": "section-09", "topic": "DUI Convictions", "subtopic": "Additional Penalties and DUI Record Length", "difficulty": "medium", "image_id": null, "image_file": null, "source_facts": ["All DUI convictions remain on your driver\'s record for 10 years."], "validation_status": "pass", "validation_notes": null, "_image_data_uri": null}, {"question_id": "q-sec09-dui-convictions-001", "question_type": "multiple_choice", "question_text": "If you are convicted of a DUI, how long will DMV suspend or revoke your driving privilege?", "choices": ["A. 6 months", "B. 1 year", "C. 2 years", "D. 5 years"], "correct_answer": "B", "explanation": "If you are convicted of a DUI, DMV will suspend or revoke your driving privilege for one year. Additional penalties such as a DUI program, insurance requirements, and fines may also apply.", "section_id": "section-09", "topic": "DUI Convictions", "subtopic": "DMV Actions and Requirements After Conviction", "difficulty": "medium", "image_id": null, "image_file": null, "source_facts": ["If you are convicted of a DUI, DMV will suspend or revoke your driving privilege for one year."], "validation_status": "pass", "validation_notes": null, "_image_data_uri": null}, {"question_id": "q-sec09-alcohol-and-drugs-010", "question_type": "multiple_choice", "question_text": "What happens if you refuse to take a blood or urine test when requested by a law enforcement officer who suspects you of DUI?", "choices": [{"label": "A", "text": "You will receive a warning only"}, {"label": "B", "text": "DMV will suspend or revoke your driving privilege for one year"}, {"label": "C", "text": "You will be fined $500"}, {"label": "D", "text": "Nothing happens; the test is optional"}], "correct_answer": "B", "explanation": "If you refuse to take a blood or urine test when requested by a law enforcement officer, DMV will suspend or revoke your driving privilege for one year.", "section_id": "section-09", "topic": "Alcohol and Drugs", "subtopic": "Medication Labels and Blood or Urine Tests", "difficulty": "medium", "image_id": null, "image_file": null, "source_facts": ["If you refuse to take a blood or urine test, DMV will suspend or revoke your driving privilege for one year."], "validation_status": "pass", "validation_notes": null, "_image_data_uri": null}, {"question_id": "q-sec09-use-or-possession-of-alcohol-or-cannabis-001", "question_type": "multiple_choice", "question_text": "While driving or riding as a passenger, which of the following is illegal?", "choices": [{"label": "A", "text": "Drinking any alcohol"}, {"label": "B", "text": "Smoking a cannabis product"}, {"label": "C", "text": "Eating a cannabis product"}, {"label": "D", "text": "All of the listed actions are illegal"}], "correct_answer": "D", "explanation": "It is illegal to drink any alcohol, smoke a cannabis product, or eat a cannabis product while you are driving or riding as a passenger in a vehicle.", "section_id": "section-09", "topic": "Use or Possession of Alcohol or Cannabis Products in a Vehicle", "subtopic": "Alcohol or Cannabis in a Vehicle", "difficulty": "easy", "image_id": null, "image_file": null, "source_facts": ["It is illegal to drink any alcohol while you are driving or riding as a passenger in a vehicle.", "It is illegal to smoke a cannabis product while you are driving or riding as a passenger in a vehicle.", "It is illegal to eat a cannabis product while you are driving or riding as a passenger in a vehicle."], "validation_status": "pass", "validation_notes": null, "_image_data_uri": null}, {"question_id": "q-sec09-dui-arrests-006", "question_type": "multiple_choice", "question_text": "After a DUI arrest, how many days do you have to request a DMV administrative hearing?", "choices": ["A. 5 days", "B. 10 days", "C. 15 days", "D. 30 days"], "correct_answer": "B", "explanation": "After a DUI arrest, you may request a DMV administrative hearing within 10 days from the date of your arrest. Missing this deadline means you lose the opportunity for this hearing.", "section_id": "section-09", "topic": "DUI Arrests", "subtopic": "After a DUI Arrest", "difficulty": "medium", "image_id": null, "image_file": null, "source_facts": ["After a DUI arrest, you may request a DMV administrative hearing within 10 days from the date of your arrest."], "validation_status": "pass", "validation_notes": null, "_image_data_uri": null}, {"question_id": "q-sec09-drivers-under-21-012", "question_type": "multiple_choice", "question_text": "If your preliminary alcohol screening (PAS) shows a BAC of what level or higher, may the officer require you to take a breath or blood test?", "choices": ["A. 0.01%", "B. 0.04%", "C. 0.05%", "D. 0.08%"], "correct_answer": "C", "explanation": "If your PAS shows a BAC of 0.05% or higher, the officer may require you to take a breath or blood test. This is a lower threshold than the standard 0.08% BAC limit for drivers over 21.", "section_id": "section-09", "topic": "Drivers Under 21", "subtopic": "Consuming Alcohol: PAS at 0.05% BAC", "difficulty": "hard", "image_id": null, "image_file": null, "source_facts": ["If your PAS shows a BAC of 0.05% or higher, the officer may require you to take a breath or blood test."], "validation_status": "pass", "validation_notes": null, "_image_data_uri": null}, {"question_id": "q-sec09-bac-limits-014", "question_type": "multiple_choice", "question_text": "According to the BAC table, what is the only safe driving limit in terms of number of drinks?", "choices": [{"label": "A", "text": "0 drinks"}, {"label": "B", "text": "1 drink"}, {"label": "C", "text": "2 drinks for heavy individuals"}, {"label": "D", "text": "1 drink for males only"}], "correct_answer": "A", "explanation": "The only safe driving limit shown in the BAC table is 0 drinks, resulting in a BAC of .00. Any number of drinks moves you into the \'Driving Skills Impaired\' or \'Legally Intoxicated\' categories.", "section_id": "section-09", "topic": "Blood Alcohol Concentration (BAC) Limits", "subtopic": "BAC Estimate Table and Drink Equivalencies", "difficulty": "easy", "image_id": null, "image_file": null, "source_facts": ["The only safe driving limit shown in the BAC table is 0 drinks, resulting in a BAC of .00."], "validation_status": "pass", "_image_data_uri": null}, {"question_id": "q-sec09-alcohol-and-drugs-007", "question_type": "multiple_choice", "question_text": "It is illegal to drive after using which of the following?", "choices": [{"label": "A", "text": "Only illegal drugs combined with alcohol"}, {"label": "B", "text": "Any combination of alcohol or drugs that decreases your ability to drive safely"}, {"label": "C", "text": "Only alcohol above the legal limit"}, {"label": "D", "text": "Only two or more illegal drugs taken together"}], "correct_answer": "B", "explanation": "No matter what age you are, it is illegal to drive after using any combination of alcohol or drugs that decreases your ability to drive safely. This includes mixing alcohol with prescription or over-the-counter medications.", "section_id": "section-09", "topic": "Alcohol and Drugs", "subtopic": "Illegal to Drive After Drinking Alcohol or Taking Drugs", "difficulty": "medium", "image_id": null, "image_file": null, "source_facts": ["No matter what age you are, it is illegal to drive after using any combination of alcohol or drugs that decreases your ability to drive safely."], "validation_status": "pass", "validation_notes": null, "_image_data_uri": null}, {"question_id": "q-sec09-drivers-under-21-008", "question_type": "multiple_choice", "question_text": "If you are under 21 and do not already have a driver\'s license, what may the court ask DMV to do if you are caught with alcohol in your vehicle?", "choices": ["A. Issue you a restricted license", "B. Require you to take extra driving lessons", "C. Delay giving you your first driver\'s license for up to one year", "D. Permanently deny your license application"], "correct_answer": "C", "explanation": "If you do not already have a driver\'s license, the court may ask DMV to delay giving you your first driver\'s license for up to one year. This penalty applies even before you have obtained a license.", "section_id": "section-09", "topic": "Drivers Under 21", "subtopic": "Possessing Alcohol: Impound, Fines, and License Consequences", "difficulty": "hard", "image_id": null, "image_file": null, "source_facts": ["If you do not already have a driver\'s license, the court may ask DMV to delay giving you your first driver\'s license for up to one year."], "validation_status": "pass", "validation_notes": null, "_image_data_uri": null}, {"question_id": "q-sec09-drivers-under-21-009", "question_type": "multiple_choice", "question_text": "If a law enforcement officer suspects an under-21 driver of consuming alcohol, which test(s) can the officer require?", "choices": ["A. Only a blood test", "B. A hand-held breath test, PAS, or another chemical test", "C. Only a urine test", "D. A written questionnaire about alcohol consumption"], "correct_answer": "B", "explanation": "If a law enforcement officer suspects you of consuming alcohol, the officer can require you to take a hand-held breath test, a preliminary alcohol screening (PAS), or another chemical test.", "section_id": "section-09", "topic": "Drivers Under 21", "subtopic": "Consuming Alcohol: Tests if Suspected", "difficulty": "medium", "image_id": null, "image_file": null, "source_facts": ["If a law enforcement officer suspects you of consuming alcohol, the officer can require you to take a hand-held breath test, PAS, or another chemical test."], "validation_status": "pass", "validation_notes": null, "_image_data_uri": null}, {"question_id": "q-sec09-drivers-under-21-013", "question_type": "multiple_choice", "question_text": "If you are under 21 and a later test shows you have a BAC of 0.05% or higher, what may happen?", "choices": ["A. You will receive a warning and be released", "B. You may be arrested for a DUI and your driving privilege may be suspended", "C. You will be required to attend a one-hour class", "D. Your parents will be notified but no further action is taken"], "correct_answer": "B", "explanation": "If a later test shows you have a BAC of 0.05% or higher, you may be arrested for a DUI and your driving privilege may be suspended. This reflects the stricter standards applied to under-21 drivers.", "section_id": "section-09", "topic": "Drivers Under 21", "subtopic": "Consuming Alcohol: Later Test at 0.05% BAC", "difficulty": "medium", "image_id": null, "image_file": null, "source_facts": ["If a later test shows you have a BAC of 0.05% or higher, you may be arrested for a DUI.", "If a later test shows you have a BAC of 0.05% or higher, your driving privilege may be suspended."], "validation_status": "pass", "validation_notes": null, "_image_data_uri": null}, {"question_id": "q-sec09-bac-limits-001", "question_type": "multiple_choice", "question_text": "What does BAC measure?", "choices": [{"label": "A", "text": "The number of drinks you have consumed"}, {"label": "B", "text": "How much alcohol is present in your bloodstream"}, {"label": "C", "text": "The proof level of the alcohol you drank"}, {"label": "D", "text": "How long alcohol stays in your liver"}], "correct_answer": "B", "explanation": "BAC stands for Blood Alcohol Concentration and measures how much alcohol is present in your bloodstream. It does not measure the number of drinks or the proof level of alcohol.", "section_id": "section-09", "topic": "Blood Alcohol Concentration (BAC) Limits", "subtopic": "What BAC Measures", "difficulty": "easy", "image_id": null, "image_file": null, "source_facts": ["BAC measures how much alcohol is present in your bloodstream."], "validation_status": "pass", "_image_data_uri": null}, {"question_id": "q-sec09-alcohol-and-drugs-012", "question_type": "multiple_choice", "question_text": "If you are 13 to 20 years old and convicted of operating a bicycle while under the influence of alcohol or drugs, what may happen to your driving privilege?", "choices": [{"label": "A", "text": "Nothing; bicycle laws do not affect driving privileges"}, {"label": "B", "text": "Your driving privilege may be suspended or delayed for one year once you are eligible to drive"}, {"label": "C", "text": "You will receive a traffic citation but no license impact"}, {"label": "D", "text": "Your driving privilege is permanently revoked"}], "correct_answer": "B", "explanation": "If you are 13 to 20 years old and convicted of operating a bicycle while under the influence of alcohol or drugs, your driving privilege may be suspended or delayed for one year once you are eligible to drive.", "section_id": "section-09", "topic": "Alcohol and Drugs", "subtopic": "IMPORTANT: Bicycle DUI (Ages 13â€“20)", "difficulty": "hard", "image_id": null, "image_file": null, "source_facts": ["If you are 13 to 20 years old and convicted of operating a bicycle while under the influence of alcohol or drugs, your driving privilege may be suspended or delayed for one year once you are eligible to drive."], "validation_status": "pass", "validation_notes": null, "_image_data_uri": null}, {"question_id": "q-sec09-bac-limits-037", "question_type": "multiple_choice", "question_text": "On which of the following is it illegal to consume alcohol or take drugs in California?", "choices": [{"label": "A", "text": "Boats and jet skis only"}, {"label": "B", "text": "Boats, jet skis, water skis, aquaplanes, or similar vessels"}, {"label": "C", "text": "Motorized boats only"}, {"label": "D", "text": "Commercial fishing vessels only"}], "correct_answer": "B", "explanation": "It is illegal to drink alcohol or take drugs when you are operating a boat, jet ski, water skis, aquaplane, or similar vessels. The rule is not limited to motorized or commercial vessels.", "section_id": "section-09", "topic": "Blood Alcohol Concentration (BAC) Limits", "subtopic": "NOTE: Alcohol or Drugs While Operating Vessels", "difficulty": "medium", "image_id": null, "image_file": null, "source_facts": ["It is illegal to drink alcohol when you are operating a boat, jet ski, water skis, aquaplane, or similar vessels.", "It is illegal to take drugs when you are operating a boat, jet ski, water skis, aquaplane, or similar vessels."], "validation_status": "pass", "_image_data_uri": null}, {"question_id": "q-sec09-drivers-under-21-001", "question_type": "true_false", "question_text": "If you are under 21 years old, there are additional laws for possessing and consuming alcohol beyond the standard DUI laws.", "choices": ["True", "False"], "correct_answer": "True", "explanation": "Drivers under 21 face additional laws regarding possessing and consuming alcohol. These stricter rules reflect California\'s zero-tolerance policy for underage drinking and driving.", "section_id": "section-09", "topic": "Drivers Under 21", "subtopic": "Under-21 Alcohol Laws", "difficulty": "easy", "image_id": null, "image_file": null, "source_facts": ["If you are under 21 years old, there are additional laws for possessing and consuming alcohol."], "validation_status": "pass", "validation_notes": null, "_image_data_uri": null}, {"question_id": "q-sec09-bac-limits-004", "question_type": "multiple_choice", "question_text": "What is the illegal BAC limit for drivers under 21 years old in California?", "choices": [{"label": "A", "text": "0.01% or higher"}, {"label": "B", "text": "0.04% or higher"}, {"label": "C", "text": "0.05% or higher"}, {"label": "D", "text": "0.08% or higher"}], "correct_answer": "A", "explanation": "For drivers under 21 years old, the illegal BAC limit is much stricter at 0.01% or higher. California has a near-zero tolerance policy for underage drinking and driving.", "section_id": "section-09", "topic": "Blood Alcohol Concentration (BAC) Limits", "subtopic": "Illegal BAC Thresholds", "difficulty": "easy", "image_id": null, "image_file": null, "source_facts": ["It is illegal to drive with a BAC of 0.01% or higher if you are under 21 years old."], "validation_status": "pass", "_image_data_uri": null}, {"question_id": "q-sec09-bac-limits-042", "question_type": "scenario", "question_text": "Jake is a 19-year-old male who weighs 160 pounds. He had just one beer at a party. According to the BAC table, his estimated BAC is .04. Is it legal for him to drive?", "choices": [{"label": "A", "text": "Yes, because .04 is below the 0.08% legal limit"}, {"label": "B", "text": "Yes, because one drink is not enough to impair driving"}, {"label": "C", "text": "No, because the illegal BAC limit for drivers under 21 is 0.01% or higher"}, {"label": "D", "text": "No, because the illegal BAC limit for all drivers is 0.04%"}], "correct_answer": "C", "explanation": "Because Jake is under 21, the illegal BAC limit is 0.01% or higher, not the standard 0.08%. His BAC of .04 far exceeds the 0.01% limit for underage drivers, making it illegal for him to drive.", "section_id": "section-09", "topic": "Blood Alcohol Concentration (BAC) Limits", "subtopic": "Illegal BAC Thresholds", "difficulty": "medium", "image_id": null, "image_file": null, "source_facts": ["It is illegal to drive with a BAC of 0.01% or higher if you are under 21 years old.", "The BAC estimate table shows an estimated BAC of .04 for a male weighing 160 pounds after 1 drinks."], "validation_status": "pass", "_image_data_uri": null}, {"question_id": "q-sec09-bac-limits-043", "question_type": "scenario", "question_text": "Sarah is a 30-year-old commercial truck driver who weighs 200 pounds. She is female and had 2 beers after work. According to the BAC table, her estimated BAC is .07. Can she legally drive her commercial vehicle?", "choices": [{"label": "A", "text": "Yes, because .07 is below the 0.08% legal limit"}, {"label": "B", "text": "Yes, because she weighs enough for the alcohol to have less effect"}, {"label": "C", "text": "No, because the illegal BAC limit for commercial vehicle drivers is 0.04% or higher"}, {"label": "D", "text": "No, because all women have a lower BAC limit"}], "correct_answer": "C", "explanation": "Because Sarah drives a vehicle requiring a commercial driver\'s license, the illegal BAC threshold is 0.04% or higher. Her BAC of .07 far exceeds this limit, making it illegal for her to drive her commercial vehicle.", "section_id": "section-09", "topic": "Blood Alcohol Concentration (BAC) Limits", "subtopic": "Illegal BAC Thresholds", "difficulty": "hard", "image_id": null, "image_file": null, "source_facts": ["It is illegal to drive with a BAC of 0.04% or higher if you drive a vehicle that requires a commercial driver\'s license.", "The BAC estimate table shows an estimated BAC of .07 for a female weighing 200 pounds after 2 drinks."], "validation_status": "pass", "_image_data_uri": null}, {"question_id": "q-sec09-bac-limits-044", "question_type": "scenario", "question_text": "David is a 35-year-old male on DUI probation who weighs 240 pounds. He had one glass of wine at dinner. According to the BAC table, his estimated BAC is .02. Is it legal for him to drive?", "choices": [{"label": "A", "text": "Yes, because .02 is well below the standard 0.08% limit"}, {"label": "B", "text": "Yes, because one drink cannot impair a 240-pound male"}, {"label": "C", "text": "No, because the illegal BAC limit for drivers on DUI probation is 0.01% or higher"}, {"label": "D", "text": "No, because DUI probation means you cannot own a vehicle"}], "correct_answer": "C", "explanation": "Since David is on DUI probation, the illegal BAC limit is 0.01% or higher at any age. His BAC of .02 exceeds this limit, making it illegal for him to drive regardless of the standard 0.08% threshold.", "section_id": "section-09", "topic": "Blood Alcohol Concentration (BAC) Limits", "subtopic": "Illegal BAC Thresholds", "difficulty": "hard", "image_id": null, "image_file": null, "source_facts": ["It is illegal to drive with a BAC of 0.01% or higher at any age if you are on DUI probation.", "The BAC estimate table shows an estimated BAC of .02 for a male weighing 240 pounds after 1 drinks."], "validation_status": "pass", "_image_data_uri": null}, {"question_id": "q-sec09-bac-limits-005", "question_type": "multiple_choice", "question_text": "What is the illegal BAC limit for a driver who is on DUI probation?", "choices": [{"label": "A", "text": "0.08% or higher"}, {"label": "B", "text": "0.04% or higher"}, {"label": "C", "text": "0.02% or higher"}, {"label": "D", "text": "0.01% or higher"}], "correct_answer": "D", "explanation": "If you are on DUI probation, the illegal BAC limit is 0.01% or higher at any age. This is the same strict standard applied to drivers under 21.", "section_id": "section-09", "topic": "Blood Alcohol Concentration (BAC) Limits", "subtopic": "Illegal BAC Thresholds", "difficulty": "medium", "image_id": null, "image_file": null, "source_facts": ["It is illegal to drive with a BAC of 0.01% or higher at any age if you are on DUI probation."], "validation_status": "pass", "_image_data_uri": null}, {"question_id": "q-sec09-drivers-under-21-016", "question_type": "true_false", "question_text": "An under-21 driver with a BAC of 0.03% cannot be convicted of a DUI because the standard legal limit is 0.08%.", "choices": ["True", "False"], "correct_answer": "False", "explanation": "For drivers under 21, the illegal BAC threshold is 0.01%, not 0.08%. A BAC of 0.03% exceeds the 0.01% limit for under-21 drivers, so they can be convicted of a DUI. DMV may revoke their driving privilege for one year.", "section_id": "section-09", "topic": "Drivers Under 21", "subtopic": "Consuming Alcohol: DUI Conviction at 0.01% BAC (Under 21)", "difficulty": "hard", "image_id": null, "image_file": null, "source_facts": ["If you are convicted of a DUI with a BAC of 0.01% or higher, DMV may revoke your driving privilege for one year (as stated here)."], "validation_status": "pass", "validation_notes": null, "_image_data_uri": null}, {"question_id": "q-sec09-bac-limits-006", "question_type": "multiple_choice", "question_text": "What is the illegal BAC limit for a driver operating a vehicle that requires a commercial driver\'s license (CDL)?", "choices": [{"label": "A", "text": "0.01% or higher"}, {"label": "B", "text": "0.04% or higher"}, {"label": "C", "text": "0.06% or higher"}, {"label": "D", "text": "0.08% or higher"}], "correct_answer": "B", "explanation": "If you drive a vehicle that requires a commercial driver\'s license, the illegal BAC threshold is 0.04% or higher, which is lower than the standard 0.08% limit for regular drivers over 21.", "section_id": "section-09", "topic": "Blood Alcohol Concentration (BAC) Limits", "subtopic": "Illegal BAC Thresholds", "difficulty": "medium", "image_id": null, "image_file": null, "source_facts": ["It is illegal to drive with a BAC of 0.04% or higher if you drive a vehicle that requires a commercial driver\'s license."], "validation_status": "pass", "_image_data_uri": null}, {"question_id": "q-sec09-dui-arrests-003", "question_type": "multiple_choice", "question_text": "What happens if you refuse to take a required chemical test when suspected of DUI in California?", "choices": ["A. You will receive a warning only", "B. DMV will suspend or revoke your driving privilege", "C. You will be required to attend traffic school", "D. Your vehicle will be impounded for 60 days"], "correct_answer": "B", "explanation": "If you refuse a required chemical test when suspected of DUI, DMV will suspend or revoke your driving privilege. California\'s implied consent law makes refusal a serious consequence.", "section_id": "section-09", "topic": "DUI Arrests", "subtopic": "Implied Consent and Chemical Tests", "difficulty": "easy", "image_id": null, "image_file": null, "source_facts": ["If you refuse a required test in this context, DMV will suspend or revoke your driving privilege."], "validation_status": "pass", "validation_notes": null, "_image_data_uri": null}, {"question_id": "q-sec09-alcohol-and-drugs-002", "question_type": "true_false", "question_text": "It is legal to drive while under the influence of a prescription medication as long as it was prescribed by your doctor.", "choices": [{"label": "True", "text": "True"}, {"label": "False", "text": "False"}], "correct_answer": "False", "explanation": "It is illegal to drive while under the influence of any drug that affects your ability to drive safely. The law does not distinguish between illegal drugs and medications obtained from a doctor or pharmacy.", "section_id": "section-09", "topic": "Alcohol and Drugs", "subtopic": "DUI Laws Apply to Alcohol and Drugs", "difficulty": "medium", "image_id": null, "image_file": null, "source_facts": ["It is illegal to drive while under the influence of any drug that affects your ability to drive safely.", "The law does not see a difference between illegal drugs and medications you get from a doctor or pharmacy for purposes of impairment."], "validation_status": "pass", "validation_notes": null, "_image_data_uri": null}, {"question_id": "q-sec09-bac-limits-011", "question_type": "true_false", "question_text": "You can only be arrested and convicted of a DUI if your BAC has been measured.", "choices": [{"label": "True", "text": "True"}, {"label": "False", "text": "False"}], "correct_answer": "False", "explanation": "This is false. Depending on how badly you are impaired, you may be arrested and convicted of a DUI even without a BAC measurement. Observable impairment alone can be sufficient for a DUI conviction.", "section_id": "section-09", "topic": "Blood Alcohol Concentration (BAC) Limits", "subtopic": "DUI Charges Even Below Legal Limits", "difficulty": "medium", "image_id": null, "image_file": null, "source_facts": ["Depending on how badly you are impaired, you may be arrested and convicted of a DUI even without a BAC measurement."], "validation_status": "pass", "_image_data_uri": null}, {"question_id": "q-sec09-dui-convictions-013", "question_type": "multiple_choice", "question_text": "Which of the following is NOT a requirement after a DUI conviction in California?", "choices": ["A. Complete a DUI program", "B. File a California Insurance Proof Certificate (SR 22/SR 1P)", "C. Retake the behind-the-wheel driving test within 30 days", "D. Pay any applicable license reissue or restriction fees"], "correct_answer": "C", "explanation": "After a DUI conviction, the requirements include completing a DUI program, filing an SR 22/SR 1P insurance certificate, and paying applicable fees. Retaking the behind-the-wheel driving test within 30 days is not listed as a requirement.", "section_id": "section-09", "topic": "DUI Convictions", "subtopic": "DMV Actions and Requirements After Conviction", "difficulty": "hard", "image_id": null, "image_file": null, "source_facts": ["If you are convicted of a DUI, you must complete a DUI program.", "If you are convicted of a DUI, you must file a California Insurance Proof Certificate (SR 22/SR 1P).", "If you are convicted of a DUI, you must pay any applicable license reissue or restriction fees."], "validation_status": "pass", "validation_notes": null, "_image_data_uri": null}, {"question_id": "q-sec09-bac-limits-012", "question_type": "multiple_choice", "question_text": "According to the BAC estimate table, which three factors determine your estimated BAC?", "choices": [{"label": "A", "text": "Age, height, and number of drinks"}, {"label": "B", "text": "Number of drinks, gender, and body weight"}, {"label": "C", "text": "Type of alcohol, body fat percentage, and food consumed"}, {"label": "D", "text": "Gender, time of day, and number of drinks"}], "correct_answer": "B", "explanation": "The BAC estimate table is based on three factors: how many drinks are consumed, gender (male/female), and body weight. These are the only variables used in the table.", "section_id": "section-09", "topic": "Blood Alcohol Concentration (BAC) Limits", "subtopic": "BAC Estimate Table and Drink Equivalencies", "difficulty": "easy", "image_id": null, "image_file": null, "source_facts": ["The BAC estimate table is based on how many drinks are consumed, gender (male/female), and body weight."], "validation_status": "pass", "_image_data_uri": null}, {"question_id": "q-sec09-dui-arrests-004", "question_type": "multiple_choice", "question_text": "Under California\'s Administrative Per Se law, what action is DMV required to take if you are arrested for DUI?", "choices": ["A. Require you to retake the driving test", "B. Suspend your driving privilege", "C. Issue you a restricted license immediately", "D. Require you to attend traffic school"], "correct_answer": "B", "explanation": "California\'s Administrative Per Se law requires DMV to suspend your driving privilege if you are arrested for DUI. This is an administrative action separate from any court proceedings.", "section_id": "section-09", "topic": "DUI Arrests", "subtopic": "After a DUI Arrest", "difficulty": "medium", "image_id": null, "image_file": null, "source_facts": ["California\'s Administrative Per Se law requires DMV to suspend your driving privilege if you are arrested for DUI."], "validation_status": "pass", "validation_notes": null, "_image_data_uri": null}, {"question_id": "q-sec09-dui-arrests-005", "question_type": "multiple_choice", "question_text": "After a DUI arrest, how long is the temporary driver\'s license that a law enforcement officer may issue you?", "choices": ["A. 10 days", "B. 15 days", "C. 30 days", "D. 60 days"], "correct_answer": "C", "explanation": "After a DUI arrest, the law enforcement officer may take your driver\'s license and give you a temporary driver\'s license that is valid for 30 days.", "section_id": "section-09", "topic": "DUI Arrests", "subtopic": "After a DUI Arrest", "difficulty": "medium", "image_id": null, "image_file": null, "source_facts": ["After a DUI arrest, a law enforcement officer may take your driver\'s license and give you a temporary driver\'s license for 30 days."], "validation_status": "pass", "validation_notes": null, "_image_data_uri": null}, {"question_id": "q-sec09-drivers-under-21-014", "question_type": "scenario", "question_text": "James is 19 years old and is driving alone with a sealed bottle of wine in his car to bring to his parents\' dinner party. Is this legal?", "choices": ["A. Yes, because the container is sealed", "B. No, because he is under 21 and no one 21 or older is in the vehicle with him", "C. Yes, because it is for his parents", "D. No, because wine is never allowed in vehicles"], "correct_answer": "B", "explanation": "If you are under 21, you may not carry any alcohol beverage inside a vehicle unless an individual who is 21 years old or older is with you. Even though the bottle is sealed, James is alone, so carrying the alcohol is illegal.", "section_id": "section-09", "topic": "Drivers Under 21", "subtopic": "Possessing Alcohol: Carrying Alcohol in a Vehicle", "difficulty": "hard", "image_id": null, "image_file": null, "source_facts": ["If you are under 21, you may not carry any alcohol beverage inside a vehicle unless an individual who is 21 years old or older is with you."], "validation_status": "pass", "validation_notes": null, "_image_data_uri": null}, {"question_id": "q-sec09-bac-limits-013", "question_type": "true_false", "question_text": "Even one drink can affect your ability to drive safely.", "choices": [{"label": "True", "text": "True"}, {"label": "False", "text": "False"}], "correct_answer": "True", "explanation": "This is true. The California Driver Handbook states that even one drink can affect your ability to drive safely. There is no completely safe amount of alcohol before driving.", "section_id": "section-09", "topic": "Blood Alcohol Concentration (BAC) Limits", "subtopic": "BAC Estimate Table and Drink Equivalencies", "difficulty": "easy", "image_id": null, "image_file": null, "source_facts": ["Even one drink can affect your ability to drive safely."], "validation_status": "pass", "_image_data_uri": null}, {"question_id": "q-sec09-bac-limits-041", "question_type": "scenario", "question_text": "Tom is a 25-year-old male who weighs 180 pounds. He consumed 3 beers (each being one standard drink) over 2 hours. If his last drink was 80 minutes before he plans to drive, approximately what would his adjusted BAC be?", "choices": [{"label": "A", "text": ".06"}, {"label": "B", "text": ".08"}, {"label": "C", "text": ".10"}, {"label": "D", "text": ".12"}], "correct_answer": "B", "explanation": "According to the BAC table, a 180-pound male after 3 drinks has an estimated BAC of .10. The BAC table note states to subtract 0.01% for each 40 minutes that lapse between drinks. Applying this rate to the 80 minutes elapsed (80 / 40 = 2 intervals), we subtract .02 from the estimate: .10 - .02 = .08. At 0.08%, Tom is right at the legal limit and should not drive.", "section_id": "section-09", "topic": "Blood Alcohol Concentration (BAC) Limits", "subtopic": "BAC Estimate Table and Drink Equivalencies", "difficulty": "hard", "image_id": null, "image_file": null, "source_facts": ["The BAC estimate table shows an estimated BAC of .10 for a male weighing 180 pounds after 3 drinks.", "You should subtract 0.01% from the BAC estimate for each 40 minutes that lapse between drinks."], "validation_status": "fixed", "fix_notes": "Fixed explanation to clarify that the BAC table note says to subtract 0.01% for each 40 minutes that lapse between drinks, and this calculation applies that rate to estimate BAC reduction over time.", "_image_data_uri": null}, {"question_id": "q-sec09-dui-convictions-009", "question_type": "multiple_choice", "question_text": "What legal consequence may you face if you cause serious injury or death while driving under the influence?", "choices": ["A. Community service only", "B. A written warning from the DMV", "C. Civil lawsuits", "D. Mandatory vehicle buy-back"], "correct_answer": "C", "explanation": "If you cause serious injury or death while driving under the influence of drugs or alcohol, you may face civil lawsuits in addition to criminal penalties. This means victims or their families can sue you for damages.", "section_id": "section-09", "topic": "DUI Convictions", "subtopic": "Additional Penalties and DUI Record Length", "difficulty": "medium", "image_id": null, "image_file": null, "source_facts": ["If you cause serious injury or death while driving under the influence of drugs or alcohol, you may face civil lawsuits."], "validation_status": "pass", "validation_notes": null, "_image_data_uri": null}, {"question_id": "q-sec09-alcohol-and-drugs-004", "question_type": "multiple_choice", "question_text": "Under California law, which types of drugs can affect your ability to drive safely?", "choices": [{"label": "A", "text": "Only illegal drugs such as cocaine or heroin"}, {"label": "B", "text": "Only over-the-counter medications"}, {"label": "C", "text": "Illegal drugs, prescription medications, and over-the-counter medications"}, {"label": "D", "text": "Only drugs that cause drowsiness"}], "correct_answer": "C", "explanation": "The law does not distinguish between illegal drugs and medications you get from a doctor or pharmacy. All of these can affect your ability to drive safely and react to what you see and hear.", "section_id": "section-09", "topic": "Alcohol and Drugs", "subtopic": "DUI Laws Apply to Alcohol and Drugs", "difficulty": "easy", "image_id": null, "image_file": null, "source_facts": ["The law does not see a difference between illegal drugs and medications you get from a doctor or pharmacy for purposes of impairment.", "Illegal drugs and medications from a doctor or pharmacy can affect your ability to drive safely and react to what you see and hear."], "validation_status": "pass", "validation_notes": null, "_image_data_uri": null}, {"question_id": "q-sec09-use-or-possession-of-alcohol-or-cannabis-003", "question_type": "multiple_choice", "question_text": "Where must you keep an open container of alcohol or cannabis in your vehicle?", "choices": [{"label": "A", "text": "In the glove box"}, {"label": "B", "text": "Under the front seat"}, {"label": "C", "text": "In the trunk or a place where passengers do not sit"}, {"label": "D", "text": "In a cup holder"}], "correct_answer": "C", "explanation": "If an alcohol or cannabis container is open, you must keep it in the trunk or a place where passengers do not sit. It is specifically illegal to keep an open container in your glove box.", "section_id": "section-09", "topic": "Use or Possession of Alcohol or Cannabis Products in a Vehicle", "subtopic": "Alcohol or Cannabis in a Vehicle", "difficulty": "medium", "image_id": null, "image_file": null, "source_facts": ["If an alcohol or cannabis container is open, you must keep it in the trunk or a place where passengers do not sit.", "It is illegal to keep an open container of alcohol in your glove box."], "validation_status": "pass", "validation_notes": null, "_image_data_uri": null}, {"question_id": "q-sec09-alcohol-and-drugs-018", "question_type": "scenario", "question_text": "James takes a prescription allergy medication that causes drowsiness. He needs to drive to work. What should he do?", "choices": [{"label": "A", "text": "Drive normally because prescription medications are exempt from DUI laws"}, {"label": "B", "text": "Read the medication label, understand the effects, and find an alternative way to get to work if the drug affects his driving"}, {"label": "C", "text": "Take a lower dose so he can still drive legally"}, {"label": "D", "text": "Only worry about it if he also drank alcohol"}], "correct_answer": "B", "explanation": "You should read medication labels and know the effects of any drug you use. The law does not distinguish between illegal drugs and prescriptions. If a medication affects your ability to drive safely, driving under its influence is illegal.", "section_id": "section-09", "topic": "Alcohol and Drugs", "subtopic": "Medication Labels and Blood or Urine Tests", "difficulty": "medium", "image_id": null, "image_file": null, "source_facts": ["You should read medication labels and know the effects of any drug you use.", "The law does not see a difference between illegal drugs and medications you get from a doctor or pharmacy for purposes of impairment.", "It is illegal to drive while under the influence of any drug that affects your ability to drive safely."], "validation_status": "pass", "validation_notes": null, "_image_data_uri": null}, {"question_id": "q-sec09-dui-arrests-002", "question_type": "true_false", "question_text": "If you agreed to take a preliminary alcohol screening (PAS) or breath test, you cannot be required to take any additional tests.", "choices": ["True", "False"], "correct_answer": "False", "explanation": "Even if you agreed to take a PAS or breath test, you may still be required to take a blood or urine test to detect the presence of drugs. The initial breath test does not exempt you from further testing.", "section_id": "section-09", "topic": "DUI Arrests", "subtopic": "Implied Consent and Chemical Tests", "difficulty": "medium", "image_id": null, "image_file": null, "source_facts": ["If you agreed to take a preliminary alcohol screening (PAS) or breath test, you may still be required to take a blood or urine test to detect the presence of drugs."], "validation_status": "pass", "validation_notes": null, "_image_data_uri": null}, {"question_id": "q-sec09-dui-arrests-009", "question_type": "true_false", "question_text": "California\'s implied consent law means you must agree to a chemical test before you are allowed to drive in the state.", "choices": ["True", "False"], "correct_answer": "False", "explanation": "Implied consent does not mean you must explicitly agree before driving. Rather, when you drive in California, you automatically consent to a breath, blood, or urine test if a law enforcement officer suspects you of DUI. The consent is implied by the act of driving.", "section_id": "section-09", "topic": "DUI Arrests", "subtopic": "Implied Consent and Chemical Tests", "difficulty": "hard", "image_id": null, "image_file": null, "source_facts": ["When you drive in California, you consent to a breath, blood, or urine test if a law enforcement officer suspects you of DUI."], "validation_status": "pass", "validation_notes": null, "_image_data_uri": null}, {"question_id": "q-sec09-dui-convictions-004", "question_type": "multiple_choice", "question_text": "After a DUI conviction, which of the following may you be required to install on your vehicle?", "choices": ["A. A GPS tracking device", "B. An ignition interlock device (IID)", "C. A dashboard camera", "D. A speed limiter"], "correct_answer": "B", "explanation": "After a DUI conviction, you may be required to install an ignition interlock device (IID) on your vehicle. An IID requires you to pass a breath test before the engine will start.", "section_id": "section-09", "topic": "DUI Convictions", "subtopic": "DMV Actions and Requirements After Conviction", "difficulty": "medium", "image_id": null, "image_file": null, "source_facts": ["If you are convicted of a DUI, you may be required to install an ignition interlock device (IID) on your vehicle."], "validation_status": "pass", "validation_notes": null, "_image_data_uri": null}, {"question_id": "q-sec09-drivers-under-21-006", "question_type": "multiple_choice", "question_text": "If you are under 21 and caught with alcohol in your vehicle, for how long may law enforcement impound your vehicle?", "choices": ["A. Up to 10 days", "B. Up to 20 days", "C. Up to 30 days", "D. Up to 60 days"], "correct_answer": "C", "explanation": "If you are caught with alcohol in your vehicle as an under-21 driver, law enforcement can impound your vehicle for up to 30 days. You may also face fines and license suspension.", "section_id": "section-09", "topic": "Drivers Under 21", "subtopic": "Possessing Alcohol: Impound, Fines, and License Consequences", "difficulty": "medium", "image_id": null, "image_file": null, "source_facts": ["If you are caught with alcohol in your vehicle, law enforcement can impound your vehicle for up to 30 days."], "validation_status": "pass", "validation_notes": null, "_image_data_uri": null}, {"question_id": "q-sec09-dui-convictions-012", "question_type": "scenario", "question_text": "David was convicted of DUI 8 years ago. He is now arrested for another DUI. Since his first conviction is still on his record, what may happen?", "choices": ["A. Nothing extra, because 8 years have passed", "B. The court or DMV may give him an additional penalty because his first conviction is still on his record", "C. His first conviction is automatically removed after 7 years", "D. He will only face the same penalty as a first-time offender"], "correct_answer": "B", "explanation": "All DUI convictions remain on your driver\'s record for 10 years. Since David\'s first conviction was only 8 years ago, it is still on his record. If you get any other DUIs during that 10-year period, the court or DMV may give you an additional penalty.", "section_id": "section-09", "topic": "DUI Convictions", "subtopic": "Additional Penalties and DUI Record Length", "difficulty": "hard", "image_id": null, "image_file": null, "source_facts": ["All DUI convictions remain on your driver\'s record for 10 years.", "If you get any other DUIs during the 10-year period, the court or DMV may give you an additional penalty."], "validation_status": "pass", "validation_notes": null, "_image_data_uri": null}, {"question_id": "q-sec09-alcohol-and-drugs-009", "question_type": "multiple_choice", "question_text": "If a law enforcement officer thinks you are driving under the influence of drugs or alcohol, what can the officer ask you to do?", "choices": [{"label": "A", "text": "Perform a field sobriety test only"}, {"label": "B", "text": "Take a blood or urine test"}, {"label": "C", "text": "Surrender your vehicle immediately"}, {"label": "D", "text": "Call a family member to pick you up"}], "correct_answer": "B", "explanation": "If a law enforcement officer thinks you are driving while under the influence of drugs or alcohol, the officer has the right to ask you to take a blood or urine test.", "section_id": "section-09", "topic": "Alcohol and Drugs", "subtopic": "Medication Labels and Blood or Urine Tests", "difficulty": "easy", "image_id": null, "image_file": null, "source_facts": ["If a law enforcement officer thinks you are driving while under the influence of drugs or alcohol, the officer has the right to ask you to take a blood or urine test."], "validation_status": "pass", "validation_notes": null, "_image_data_uri": null}, {"question_id": "q-sec09-bac-limits-007", "question_type": "multiple_choice", "question_text": "What is the illegal BAC limit if you are driving a passenger for hire (such as a taxi or rideshare)?", "choices": [{"label": "A", "text": "0.08% or higher"}, {"label": "B", "text": "0.06% or higher"}, {"label": "C", "text": "0.04% or higher"}, {"label": "D", "text": "0.02% or higher"}], "correct_answer": "C", "explanation": "If you are driving a passenger for hire, the illegal BAC threshold is 0.04% or higher. This is the same standard that applies to commercial vehicle drivers.", "section_id": "section-09", "topic": "Blood Alcohol Concentration (BAC) Limits", "subtopic": "Illegal BAC Thresholds", "difficulty": "medium", "image_id": null, "image_file": null, "source_facts": ["It is illegal to drive with a BAC of 0.04% or higher if you are driving a passenger for hire."], "validation_status": "pass", "_image_data_uri": null}, {"question_id": "q-sec09-bac-limits-018", "question_type": "multiple_choice", "question_text": "According to the California Driver Handbook, one standard drink is equivalent to which of the following?", "choices": [{"label": "A", "text": "1.5 oz. of 80 proof liquor"}, {"label": "B", "text": "16 oz. of 5% beer"}, {"label": "C", "text": "8 oz. of 12% wine"}, {"label": "D", "text": "2 oz. of 100 proof liquor"}], "correct_answer": "A", "explanation": "One drink is defined as 1.5 oz. of 80 proof liquor, 12 oz. of 5% beer, or 5 oz. of 12% wine. The 1.5 oz. of 80 proof liquor is the correct equivalency.", "section_id": "section-09", "topic": "Blood Alcohol Concentration (BAC) Limits", "subtopic": "BAC Estimate Table and Drink Equivalencies", "difficulty": "medium", "image_id": null, "image_file": null, "source_facts": ["One drink is defined as 1.5 oz. of 80 proof liquor, 12 oz. of 5% beer, or 5 oz. of 12% wine."], "validation_status": "pass", "_image_data_uri": null}, {"question_id": "q-sec09-use-or-possession-of-alcohol-or-cannabis-002", "question_type": "multiple_choice", "question_text": "If you are carrying alcohol or cannabis in your vehicle, what must be true about the container?", "choices": [{"label": "A", "text": "It must be in a paper bag"}, {"label": "B", "text": "It must be sealed and unopened"}, {"label": "C", "text": "It must be within arm\'s reach of the driver"}, {"label": "D", "text": "It must be labeled with a warning sticker"}], "correct_answer": "B", "explanation": "If you are carrying alcohol or cannabis in your vehicle, the container must be sealed and unopened. If it is open, you must keep the container in the trunk or a place where passengers do not sit.", "section_id": "section-09", "topic": "Use or Possession of Alcohol or Cannabis Products in a Vehicle", "subtopic": "Alcohol or Cannabis in a Vehicle", "difficulty": "easy", "image_id": null, "image_file": null, "source_facts": ["If you are carrying alcohol or cannabis in your vehicle, the container must be sealed and unopened."], "validation_status": "pass", "validation_notes": null, "_image_data_uri": null}, {"question_id": "q-sec09-alcohol-and-drugs-020", "question_type": "multiple_choice", "question_text": "Which of the following is considered a form of alcohol for DUI purposes?", "choices": [{"label": "A", "text": "Cough syrup containing alcohol"}, {"label": "B", "text": "Non-alcoholic beer"}, {"label": "C", "text": "Caffeinated energy drinks"}, {"label": "D", "text": "Carbonated water"}], "correct_answer": "A", "explanation": "It is illegal to drive after drinking excessive amounts of alcohol in any form, and this includes medications like cough syrup that contain alcohol.", "section_id": "section-09", "topic": "Alcohol and Drugs", "subtopic": "Illegal to Drive After Drinking Alcohol or Taking Drugs", "difficulty": "medium", "image_id": null, "image_file": null, "source_facts": ["No matter what age you are, it is illegal to drive after drinking excessive amounts of alcohol in any form.", "Medications like cough syrup count as alcohol in this context."], "validation_status": "pass", "validation_notes": null, "_image_data_uri": null}, {"question_id": "q-sec09-dui-arrests-008", "question_type": "scenario", "question_text": "Maria, age 25, is pulled over on suspicion of DUI. The officer asks her to take a breath test. She agrees and takes the breath test. The officer then asks her to take a blood test to check for drugs. Can the officer require this additional test?", "choices": ["A. No, because she already took a breath test", "B. Yes, she may still be required to take a blood or urine test to detect the presence of drugs", "C. No, because only one test is allowed per stop", "D. Yes, but only if the breath test result was positive"], "correct_answer": "B", "explanation": "Even if you agreed to take a preliminary alcohol screening or breath test, you may still be required to take a blood or urine test to detect the presence of drugs. Agreeing to one test does not exempt you from additional testing.", "section_id": "section-09", "topic": "DUI Arrests", "subtopic": "Implied Consent and Chemical Tests", "difficulty": "hard", "image_id": null, "image_file": null, "source_facts": ["If you agreed to take a preliminary alcohol screening (PAS) or breath test, you may still be required to take a blood or urine test to detect the presence of drugs."], "validation_status": "pass", "validation_notes": null, "_image_data_uri": null}, {"question_id": "q-sec09-use-or-possession-of-alcohol-or-cannabis-005", "question_type": "multiple_choice", "question_text": "The open-container law for vehicles does NOT apply to passengers in which of the following?", "choices": [{"label": "A", "text": "Private cars"}, {"label": "B", "text": "Rental vehicles"}, {"label": "C", "text": "Buses, taxis, campers, or motorhomes"}, {"label": "D", "text": "Company-owned vehicles"}], "correct_answer": "C", "explanation": "The vehicle open-container rule does not apply if you are a passenger in a bus, taxi, camper, or motorhome. However, it still applies to drivers and passengers in standard private vehicles.", "section_id": "section-09", "topic": "Use or Possession of Alcohol or Cannabis Products in a Vehicle", "subtopic": "Alcohol or Cannabis in a Vehicle", "difficulty": "medium", "image_id": null, "image_file": null, "source_facts": ["The vehicle open-container rule in this section does not apply if you are a passenger in a bus, taxi, camper, or motorhome."], "validation_status": "pass", "validation_notes": null, "_image_data_uri": null}, {"question_id": "q-sec09-use-or-possession-of-alcohol-or-cannabis-008", "question_type": "scenario", "question_text": "You are driving home from a party with a half-empty bottle of wine. Where should you place the bottle in your vehicle?", "choices": [{"label": "A", "text": "On the back seat"}, {"label": "B", "text": "In the glove box"}, {"label": "C", "text": "In the trunk"}, {"label": "D", "text": "Under the front passenger seat"}], "correct_answer": "C", "explanation": "If an alcohol container is open, you must keep the container in the trunk or a place where passengers do not sit. It is specifically illegal to keep an open container of alcohol in your glove box, and the back seat and under the passenger seat are areas where passengers sit.", "section_id": "section-09", "topic": "Use or Possession of Alcohol or Cannabis Products in a Vehicle", "subtopic": "Alcohol or Cannabis in a Vehicle", "difficulty": "medium", "image_id": null, "image_file": null, "source_facts": ["If an alcohol or cannabis container is open, you must keep it in the trunk or a place where passengers do not sit.", "It is illegal to keep an open container of alcohol in your glove box."], "validation_status": "pass", "validation_notes": null, "_image_data_uri": null}]');

/* ---- State ---- */
var filtered = [];       // Current filtered/shuffled question list (indices into ALL_QUESTIONS)
var currentIdx = 0;      // Index into filtered[]
var answers = {};        // questionIndex -> selected choice index
var revealed = {};       // questionIndex -> true if answer was revealed

/* ---- DOM refs ---- */
var $counter = document.getElementById('q-counter');
var $sectionLabel = document.getElementById('q-section-label');
var $topicLabel = document.getElementById('q-topic-label');
var $difficultyLabel = document.getElementById('q-difficulty-label');
var $imageWrapper = document.getElementById('q-image-wrapper');
var $image = document.getElementById('q-image');
var $text = document.getElementById('q-text');
var $choices = document.getElementById('choices-container');
var $feedback = document.getElementById('feedback');
var $feedbackText = document.getElementById('feedback-text');
var $explanation = document.getElementById('explanation');
var $btnShow = document.getElementById('btn-show-answer');
var $btnPrev = document.getElementById('btn-prev');
var $btnNext = document.getElementById('btn-next');
var $progressBar = document.getElementById('progress-bar');
var $scoreCorrect = document.getElementById('score-correct');
var $scoreIncorrect = document.getElementById('score-incorrect');
var $scoreUnanswered = document.getElementById('score-unanswered');
var $questionContainer = document.getElementById('question-container');
var $summaryContainer = document.getElementById('summary-container');
var $emptyState = document.getElementById('empty-state');
var $filterSection = document.getElementById('filter-section');
var $filterTopic = document.getElementById('filter-topic');
var $filterDifficulty = document.getElementById('filter-difficulty');
var $filterType = document.getElementById('filter-type');
var $btnShuffle = document.getElementById('btn-shuffle');
var $btnReset = document.getElementById('btn-reset');

/* ---- Helpers ---- */
function escapeHtml(str) {
  var div = document.createElement('div');
  div.appendChild(document.createTextNode(str || ''));
  return div.innerHTML;
}

function getField(q, names, fallback) {
  for (var i = 0; i < names.length; i++) {
    if (q[names[i]] !== undefined && q[names[i]] !== null && q[names[i]] !== '') return q[names[i]];
  }
  return fallback || '';
}

function getSection(q) { return getField(q, ['section', 'section_id', 'section_title'], 'Unknown'); }
function getTopic(q) { return getField(q, ['topic', 'topic_title', 'topic_id'], ''); }
function getDifficulty(q) { return getField(q, ['difficulty', 'difficulty_level'], ''); }
function getType(q) { return getField(q, ['question_type', 'type'], 'multiple_choice'); }
function getQuestionText(q) { return getField(q, ['question_text', 'question', 'text'], ''); }
function getExplanation(q) { return getField(q, ['explanation', 'rationale', 'answer_explanation'], ''); }

function getChoices(q) {
  // Choices may be an array of strings or an array of objects with label/text keys.
  var raw = q.choices || q.options || q.answers || [];
  var result = [];
  for (var i = 0; i < raw.length; i++) {
    var c = raw[i];
    if (typeof c === 'string') {
      result.push(c);
    } else if (c && typeof c === 'object') {
      result.push(c.text || c.label || c.value || c.choice || JSON.stringify(c));
    } else {
      result.push(String(c));
    }
  }
  // For true_false questions with no explicit choices, supply them.
  if (result.length === 0 && getType(q) === 'true_false') {
    result = ['True', 'False'];
  }
  return result;
}

function getCorrectIndex(q) {
  // correct_answer may be an index (int), a letter (A/B/C/D), or the answer text.
  var ca = q.correct_answer !== undefined ? q.correct_answer : (q.answer !== undefined ? q.answer : null);
  if (ca === null || ca === undefined) return -1;
  var choices = getChoices(q);
  // Integer index
  if (typeof ca === 'number') return ca;
  var s = String(ca).trim();
  // Single letter A-Z
  if (/^[A-Za-z]$/.test(s)) {
    var idx = s.toUpperCase().charCodeAt(0) - 65;
    if (idx >= 0 && idx < choices.length) return idx;
  }
  // Letter with parentheses or period: "A)" or "A."
  var letterMatch = s.match(/^([A-Za-z])[\).:\s]/);
  if (letterMatch) {
    var li = letterMatch[1].toUpperCase().charCodeAt(0) - 65;
    if (li >= 0 && li < choices.length) return li;
  }
  // Exact text match
  for (var i = 0; i < choices.length; i++) {
    if (choices[i].trim() === s) return i;
  }
  // Substring match (correct_answer text contained in a choice)
  for (var j = 0; j < choices.length; j++) {
    if (choices[j].toLowerCase().indexOf(s.toLowerCase()) !== -1) return j;
    if (s.toLowerCase().indexOf(choices[j].toLowerCase()) !== -1) return j;
  }
  // Numeric string
  var num = parseInt(s, 10);
  if (!isNaN(num) && num >= 0 && num < choices.length) return num;
  return -1;
}

/* ---- Filter population ---- */
function populateFilters() {
  var sections = {}, topics = {}, difficulties = {}, types = {};
  for (var i = 0; i < ALL_QUESTIONS.length; i++) {
    var q = ALL_QUESTIONS[i];
    var s = getSection(q); if (s) sections[s] = true;
    var t = getTopic(q); if (t) topics[t] = true;
    var d = getDifficulty(q); if (d) difficulties[d] = true;
    var tp = getType(q); if (tp) types[tp] = true;
  }
  fillSelect($filterSection, sections);
  fillSelect($filterTopic, topics);
  fillSelect($filterDifficulty, difficulties);
  fillSelect($filterType, types);
}

function fillSelect(el, map) {
  var keys = Object.keys(map).sort();
  for (var i = 0; i < keys.length; i++) {
    var opt = document.createElement('option');
    opt.value = keys[i];
    opt.textContent = keys[i];
    el.appendChild(opt);
  }
}

/* ---- Filtering ---- */
function applyFilters() {
  var sv = $filterSection.value;
  var tv = $filterTopic.value;
  var dv = $filterDifficulty.value;
  var tpv = $filterType.value;
  filtered = [];
  for (var i = 0; i < ALL_QUESTIONS.length; i++) {
    var q = ALL_QUESTIONS[i];
    if (sv !== 'all' && getSection(q) !== sv) continue;
    if (tv !== 'all' && getTopic(q) !== tv) continue;
    if (dv !== 'all' && getDifficulty(q) !== dv) continue;
    if (tpv !== 'all' && getType(q) !== tpv) continue;
    filtered.push(i);
  }
  currentIdx = 0;
  updateView();
}

/* ---- Shuffle ---- */
function shuffleArray(arr) {
  for (var i = arr.length - 1; i > 0; i--) {
    var j = Math.floor(Math.random() * (i + 1));
    var tmp = arr[i]; arr[i] = arr[j]; arr[j] = tmp;
  }
}

/* ---- Score calculation ---- */
function calcScores() {
  var correct = 0, incorrect = 0, unanswered = 0;
  for (var i = 0; i < filtered.length; i++) {
    var qi = filtered[i];
    if (answers[qi] !== undefined) {
      var q = ALL_QUESTIONS[qi];
      if (answers[qi] === getCorrectIndex(q)) correct++;
      else incorrect++;
    } else {
      unanswered++;
    }
  }
  return { correct: correct, incorrect: incorrect, unanswered: unanswered, total: filtered.length };
}

function updateScoreDisplay() {
  var s = calcScores();
  $scoreCorrect.textContent = 'Correct: ' + s.correct;
  $scoreIncorrect.textContent = 'Incorrect: ' + s.incorrect;
  $scoreUnanswered.textContent = 'Remaining: ' + s.unanswered;
  // Progress bar: answered / total
  var pct = s.total > 0 ? ((s.correct + s.incorrect) / s.total * 100) : 0;
  $progressBar.style.width = pct + '%';
}

/* ---- Rendering ---- */
function renderQuestion() {
  if (filtered.length === 0) {
    $questionContainer.style.display = 'none';
    $summaryContainer.style.display = 'none';
    $emptyState.style.display = 'block';
    updateScoreDisplay();
    return;
  }
  $emptyState.style.display = 'none';
  $summaryContainer.style.display = 'none';
  $questionContainer.style.display = 'block';

  var qi = filtered[currentIdx];
  var q = ALL_QUESTIONS[qi];

  // Counter
  $counter.textContent = 'Question ' + (currentIdx + 1) + ' of ' + filtered.length;

  // Meta tags
  $sectionLabel.textContent = getSection(q);
  var topic = getTopic(q);
  $topicLabel.textContent = topic;
  $topicLabel.style.display = topic ? '' : 'none';
  var diff = getDifficulty(q);
  $difficultyLabel.textContent = diff;
  $difficultyLabel.style.display = diff ? '' : 'none';

  // Image
  var imgUri = q._image_data_uri;
  if (imgUri) {
    $image.src = imgUri;
    $imageWrapper.style.display = 'block';
  } else {
    $imageWrapper.style.display = 'none';
    $image.src = '';
  }

  // Question text
  $text.innerHTML = escapeHtml(getQuestionText(q));

  // Choices
  var choices = getChoices(q);
  $choices.innerHTML = '';
  var isRevealed = !!revealed[qi];
  var selectedIdx = answers[qi];
  var correctIdx = getCorrectIndex(q);
  var letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';

  for (var i = 0; i < choices.length; i++) {
    var btn = document.createElement('button');
    btn.className = 'choice-btn';
    btn.setAttribute('data-idx', i);

    var letterSpan = document.createElement('span');
    letterSpan.className = 'choice-letter';
    letterSpan.textContent = (i < letters.length ? letters[i] : (i + 1)) + '.';

    var textSpan = document.createElement('span');
    textSpan.className = 'choice-text';
    textSpan.textContent = choices[i];

    btn.appendChild(letterSpan);
    btn.appendChild(textSpan);

    // Styling based on state
    if (isRevealed) {
      if (i === correctIdx) {
        btn.classList.add('choice-correct');
      }
      if (selectedIdx !== undefined && i === selectedIdx && i !== correctIdx) {
        btn.classList.add('choice-incorrect');
      }
      btn.disabled = true;
    } else if (selectedIdx !== undefined && i === selectedIdx) {
      btn.classList.add('choice-selected');
    }

    btn.addEventListener('click', (function(idx) {
      return function() { selectChoice(idx); };
    })(i));

    $choices.appendChild(btn);
  }

  // Feedback
  if (isRevealed) {
    $feedback.style.display = 'block';
    if (selectedIdx === correctIdx) {
      $feedbackText.textContent = 'Correct!';
      $feedbackText.className = 'feedback-correct';
    } else if (selectedIdx !== undefined) {
      $feedbackText.textContent = 'Incorrect. The correct answer is ' + (correctIdx < letters.length ? letters[correctIdx] : (correctIdx + 1)) + '.';
      $feedbackText.className = 'feedback-incorrect';
    } else {
      $feedbackText.textContent = 'The correct answer is ' + (correctIdx < letters.length ? letters[correctIdx] : (correctIdx + 1)) + '.';
      $feedbackText.className = 'feedback-neutral';
    }
    var expl = getExplanation(q);
    if (expl) {
      $explanation.style.display = 'block';
      $explanation.innerHTML = '<strong>Explanation:</strong> ' + escapeHtml(expl);
    } else {
      $explanation.style.display = 'none';
    }
    $btnShow.style.display = 'none';
  } else {
    $feedback.style.display = 'none';
    $explanation.style.display = 'none';
    $btnShow.style.display = '';
  }

  // Nav buttons
  $btnPrev.disabled = (currentIdx === 0);
  $btnNext.textContent = (currentIdx === filtered.length - 1) ? 'Finish' : 'Next \u2192';

  updateScoreDisplay();
}

function selectChoice(idx) {
  var qi = filtered[currentIdx];
  if (revealed[qi]) return;
  answers[qi] = idx;
  renderQuestion();
}

function revealAnswer() {
  var qi = filtered[currentIdx];
  revealed[qi] = true;
  renderQuestion();
}

function goNext() {
  if (currentIdx < filtered.length - 1) {
    currentIdx++;
    renderQuestion();
    window.scrollTo(0, 0);
  } else {
    showSummary();
  }
}

function goPrev() {
  if (currentIdx > 0) {
    currentIdx--;
    renderQuestion();
    window.scrollTo(0, 0);
  }
}

/* ---- Summary ---- */
function showSummary() {
  $questionContainer.style.display = 'none';
  $emptyState.style.display = 'none';
  $summaryContainer.style.display = 'block';

  var s = calcScores();
  var pct = s.total > 0 ? Math.round(s.correct / s.total * 100) : 0;
  var passed = pct >= 83;  // CA DMV passing score

  document.getElementById('summary-score').innerHTML =
    '<div class="summary-big-score">' + s.correct + ' / ' + s.total + '</div>' +
    '<div class="summary-pct ' + (passed ? 'summary-pass' : 'summary-fail') + '">' + pct + '%' +
    (passed ? ' -- PASS' : ' -- NEEDS PRACTICE') + '</div>' +
    '<div class="summary-detail">' +
    '<span class="score-chip correct-chip">Correct: ' + s.correct + '</span> ' +
    '<span class="score-chip incorrect-chip">Incorrect: ' + s.incorrect + '</span> ' +
    '<span class="score-chip unanswered-chip">Unanswered: ' + s.unanswered + '</span>' +
    '</div>';

  // Breakdown by section
  var sectionStats = {};
  for (var i = 0; i < filtered.length; i++) {
    var qi = filtered[i];
    var q = ALL_QUESTIONS[qi];
    var sec = getSection(q);
    if (!sectionStats[sec]) sectionStats[sec] = { correct: 0, incorrect: 0, unanswered: 0, total: 0 };
    sectionStats[sec].total++;
    if (answers[qi] !== undefined) {
      if (answers[qi] === getCorrectIndex(q)) sectionStats[sec].correct++;
      else sectionStats[sec].incorrect++;
    } else {
      sectionStats[sec].unanswered++;
    }
  }
  var bhtml = '<h3>Breakdown by Section</h3><table class="breakdown-table"><thead><tr><th>Section</th><th>Correct</th><th>Incorrect</th><th>Unanswered</th><th>Score</th></tr></thead><tbody>';
  var skeys = Object.keys(sectionStats).sort();
  for (var j = 0; j < skeys.length; j++) {
    var st = sectionStats[skeys[j]];
    var sp = st.total > 0 ? Math.round(st.correct / st.total * 100) : 0;
    bhtml += '<tr><td>' + escapeHtml(skeys[j]) + '</td><td>' + st.correct + '</td><td>' + st.incorrect + '</td><td>' + st.unanswered + '</td><td>' + sp + '%</td></tr>';
  }
  bhtml += '</tbody></table>';
  document.getElementById('summary-breakdown').innerHTML = bhtml;

  updateScoreDisplay();
}

/* ---- Main view toggle ---- */
function updateView() {
  renderQuestion();
}

/* ---- Reset ---- */
function resetAll() {
  answers = {};
  revealed = {};
  currentIdx = 0;
  updateView();
}

/* ---- Event listeners ---- */
$btnShow.addEventListener('click', revealAnswer);
$btnNext.addEventListener('click', goNext);
$btnPrev.addEventListener('click', goPrev);
$filterSection.addEventListener('change', applyFilters);
$filterTopic.addEventListener('change', applyFilters);
$filterDifficulty.addEventListener('change', applyFilters);
$filterType.addEventListener('change', applyFilters);
$btnShuffle.addEventListener('click', function() {
  shuffleArray(filtered);
  currentIdx = 0;
  updateView();
});
$btnReset.addEventListener('click', resetAll);
document.getElementById('btn-review').addEventListener('click', function() {
  currentIdx = 0;
  $summaryContainer.style.display = 'none';
  $questionContainer.style.display = 'block';
  renderQuestion();
});
document.getElementById('btn-restart').addEventListener('click', function() {
  resetAll();
  $summaryContainer.style.display = 'none';
});

// Keyboard navigation
document.addEventListener('keydown', function(e) {
  if ($summaryContainer.style.display !== 'none') return;
  if ($questionContainer.style.display === 'none') return;
  if (e.key === 'ArrowRight' || e.key === 'n') goNext();
  else if (e.key === 'ArrowLeft' || e.key === 'p') goPrev();
  else if (e.key === 'Enter' || e.key === ' ') {
    var qi = filtered[currentIdx];
    if (!revealed[qi]) { e.preventDefault(); revealAnswer(); }
  }
  else if (e.key >= '1' && e.key <= '9') {
    var ci = parseInt(e.key, 10) - 1;
    var qi2 = filtered[currentIdx];
    if (!revealed[qi2] && ci < getChoices(ALL_QUESTIONS[qi2]).length) selectChoice(ci);
  }
  else if (e.key >= 'a' && e.key <= 'z' && e.key.length === 1) {
    var ci2 = e.key.charCodeAt(0) - 97;
    var qi3 = filtered[currentIdx];
    if (!revealed[qi3] && ci2 < getChoices(ALL_QUESTIONS[qi3]).length) selectChoice(ci2);
  }
});

/* ---- Init ---- */
populateFilters();
applyFilters();

})();
</script>
</body>
</html>