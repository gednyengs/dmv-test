<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CA DMV Practice Test -- Alcohol and Drugs</title>
<style>
*, *::before, *::after {
  box-sizing: border-box;
}

body {
  margin: 0;
  padding: 0;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
  background: #f5f7fa;
  color: #1a1a2e;
  line-height: 1.6;
}

#app {
  max-width: 800px;
  margin: 0 auto;
  padding: 16px;
}

/* Header */
header {
  text-align: center;
  margin-bottom: 16px;
}

header h1 {
  font-size: 1.5rem;
  margin: 0 0 12px 0;
  color: #003366;
}

#progress-bar-container {
  width: 100%;
  height: 8px;
  background: #dde1e7;
  border-radius: 4px;
  overflow: hidden;
  margin-bottom: 10px;
}

#progress-bar {
  height: 100%;
  width: 0%;
  background: linear-gradient(90deg, #2e7d32, #43a047);
  border-radius: 4px;
  transition: width 0.3s ease;
}

#score-display {
  display: flex;
  justify-content: center;
  gap: 12px;
  flex-wrap: wrap;
}

.score-chip {
  display: inline-block;
  padding: 4px 12px;
  border-radius: 16px;
  font-size: 0.85rem;
  font-weight: 600;
}

.correct-chip {
  background: #e8f5e9;
  color: #2e7d32;
}

.incorrect-chip {
  background: #ffebee;
  color: #c62828;
}

.unanswered-chip {
  background: #e3f2fd;
  color: #1565c0;
}

/* Filter bar */
#filter-bar {
  display: flex;
  gap: 10px;
  flex-wrap: wrap;
  align-items: center;
  margin-bottom: 20px;
  padding: 12px;
  background: #ffffff;
  border-radius: 8px;
  box-shadow: 0 1px 3px rgba(0,0,0,0.08);
}

.filter-group {
  display: flex;
  align-items: center;
  gap: 4px;
}

.filter-group label {
  font-size: 0.8rem;
  font-weight: 600;
  color: #555;
  white-space: nowrap;
}

.filter-group select {
  font-size: 0.85rem;
  padding: 4px 8px;
  border: 1px solid #ccc;
  border-radius: 4px;
  background: #fff;
  max-width: 180px;
}

#btn-shuffle, #btn-reset {
  font-size: 0.85rem;
  padding: 5px 14px;
  border: 1px solid #ccc;
  border-radius: 4px;
  background: #fff;
  cursor: pointer;
  font-weight: 600;
  color: #333;
  transition: background 0.2s;
}

#btn-shuffle:hover, #btn-reset:hover {
  background: #eee;
}

/* Question container */
#question-container {
  background: #ffffff;
  border-radius: 12px;
  padding: 24px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.08);
}

#question-meta {
  display: flex;
  align-items: center;
  gap: 10px;
  flex-wrap: wrap;
  margin-bottom: 16px;
}

#q-counter {
  font-weight: 700;
  font-size: 0.95rem;
  color: #003366;
}

.meta-tag {
  font-size: 0.75rem;
  padding: 2px 10px;
  border-radius: 12px;
  background: #e8eaf6;
  color: #283593;
  font-weight: 600;
}

/* Image */
#q-image-wrapper {
  text-align: center;
  margin-bottom: 16px;
}

#q-image {
  max-width: 100%;
  max-height: 360px;
  border-radius: 8px;
  border: 1px solid #ddd;
  object-fit: contain;
}

/* Question text */
#q-text {
  font-size: 1.1rem;
  font-weight: 500;
  margin-bottom: 20px;
  line-height: 1.5;
}

/* Choices */
#choices-container {
  display: flex;
  flex-direction: column;
  gap: 8px;
  margin-bottom: 20px;
}

.choice-btn {
  display: flex;
  align-items: flex-start;
  gap: 10px;
  width: 100%;
  padding: 12px 16px;
  border: 2px solid #dde1e7;
  border-radius: 8px;
  background: #fafbfc;
  cursor: pointer;
  text-align: left;
  font-size: 1rem;
  line-height: 1.4;
  transition: border-color 0.15s, background 0.15s;
}

.choice-btn:hover:not(:disabled) {
  border-color: #90caf9;
  background: #e3f2fd;
}

.choice-btn:disabled {
  cursor: default;
  opacity: 0.55;
  pointer-events: none;
}

.choice-btn:disabled.choice-correct,
.choice-btn:disabled.choice-incorrect {
  opacity: 1;
}

.choice-letter {
  font-weight: 700;
  color: #555;
  min-width: 24px;
  flex-shrink: 0;
}

.choice-text {
  flex: 1;
}

.choice-selected {
  border-color: #1976d2;
  background: #e3f2fd;
}

.choice-correct {
  border-color: #2e7d32 !important;
  background: #e8f5e9 !important;
}

.choice-correct .choice-letter {
  color: #2e7d32;
}

.choice-incorrect {
  border-color: #c62828 !important;
  background: #ffebee !important;
}

.choice-incorrect .choice-letter {
  color: #c62828;
}

/* Feedback */
#feedback {
  margin-bottom: 16px;
  padding: 12px 16px;
  border-radius: 8px;
  font-size: 0.95rem;
}

.feedback-correct {
  color: #2e7d32;
  font-weight: 700;
  font-size: 1.05rem;
}

.feedback-incorrect {
  color: #c62828;
  font-weight: 700;
  font-size: 1.05rem;
}

.feedback-neutral {
  color: #555;
  font-weight: 600;
}

#explanation {
  margin-top: 10px;
  padding: 12px 16px;
  background: #fff8e1;
  border-left: 4px solid #ffa000;
  border-radius: 4px;
  font-size: 0.95rem;
  line-height: 1.5;
}

/* Buttons */
#action-buttons {
  text-align: center;
  margin-bottom: 16px;
}

.btn-primary {
  padding: 10px 28px;
  font-size: 1rem;
  font-weight: 600;
  color: #fff;
  background: #1976d2;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  transition: background 0.2s;
  margin: 4px;
}

.btn-primary:hover {
  background: #1565c0;
}

#nav-buttons {
  display: flex;
  justify-content: space-between;
}

.btn-nav {
  padding: 10px 24px;
  font-size: 0.95rem;
  font-weight: 600;
  color: #333;
  background: #e0e0e0;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  transition: background 0.2s;
}

.btn-nav:hover:not(:disabled) {
  background: #bdbdbd;
}

.btn-nav:disabled {
  opacity: 0.4;
  cursor: default;
}

/* Summary */
#summary-container {
  background: #ffffff;
  border-radius: 12px;
  padding: 32px 24px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.08);
  text-align: center;
}

#summary-container h2 {
  color: #003366;
  margin-top: 0;
}

.summary-big-score {
  font-size: 2.5rem;
  font-weight: 800;
  color: #1a1a2e;
  margin: 16px 0 4px;
}

.summary-pct {
  font-size: 1.3rem;
  font-weight: 700;
  margin-bottom: 16px;
}

.summary-pass { color: #2e7d32; }
.summary-fail { color: #c62828; }

.summary-detail {
  margin-bottom: 24px;
}

.breakdown-table {
  width: 100%;
  border-collapse: collapse;
  margin: 16px 0 24px;
  font-size: 0.9rem;
  text-align: left;
}

.breakdown-table th {
  background: #e8eaf6;
  padding: 8px 12px;
  font-weight: 700;
  color: #283593;
}

.breakdown-table td {
  padding: 8px 12px;
  border-bottom: 1px solid #eee;
}

/* Empty state */
#empty-state {
  text-align: center;
  padding: 48px 24px;
  color: #777;
  font-size: 1.1rem;
}

/* Back link */
.back-link {
  display: inline-block;
  margin-bottom: 8px;
  font-size: 0.9rem;
  color: #1976d2;
  text-decoration: none;
  font-weight: 600;
}

.back-link:hover {
  text-decoration: underline;
}

/* Extra questions link */
.extra-link {
  display: block;
  text-align: center;
  margin-top: 24px;
  padding: 14px 24px;
  background: #ffffff;
  border: 2px solid #1976d2;
  border-radius: 12px;
  color: #1976d2;
  font-weight: 600;
  font-size: 1rem;
  text-decoration: none;
  transition: background 0.2s, color 0.2s;
}

.extra-link:hover {
  background: #1976d2;
  color: #ffffff;
}

/* Responsive */
@media (max-width: 600px) {
  #app { padding: 8px; }
  header h1 { font-size: 1.2rem; }
  #question-container { padding: 16px; }
  #q-text { font-size: 1rem; }
  .choice-btn { padding: 10px 12px; font-size: 0.95rem; }
  #filter-bar { gap: 6px; padding: 8px; }
  .filter-group select { max-width: 120px; }
  .summary-big-score { font-size: 2rem; }
}

</style>
</head>
<body>

<div id="app">
  <!-- Header -->
  <header id="header">
    <a href="index.html" class="back-link">&larr; All Sections</a>
    <h1>CA DMV Practice Test -- Alcohol and Drugs</h1>
    <div id="progress-bar-container">
      <div id="progress-bar"></div>
    </div>
    <div id="score-display">
      <span id="score-correct" class="score-chip correct-chip">Correct: 0</span>
      <span id="score-incorrect" class="score-chip incorrect-chip">Incorrect: 0</span>
      <span id="score-unanswered" class="score-chip unanswered-chip">Remaining: 0</span>
    </div>
  </header>

  <!-- Filter controls -->
  <div id="filter-bar">
    <div class="filter-group" style="display:none;">
      <label for="filter-section">Section:</label>
      <select id="filter-section"><option value="all">All Sections</option></select>
    </div>
    <div class="filter-group">
      <label for="filter-topic">Topic:</label>
      <select id="filter-topic"><option value="all">All Topics</option></select>
    </div>
    <div class="filter-group">
      <label for="filter-difficulty">Difficulty:</label>
      <select id="filter-difficulty"><option value="all">All</option></select>
    </div>
    <div class="filter-group">
      <label for="filter-type">Type:</label>
      <select id="filter-type"><option value="all">All</option></select>
    </div>
    <button id="btn-shuffle" title="Shuffle questions">Shuffle</button>
    <button id="btn-reset" title="Reset all answers">Reset</button>
  </div>

  <!-- Question slide -->
  <div id="question-container" style="display:none;">
    <div id="question-meta">
      <span id="q-counter">Question 1 of 1</span>
      <span id="q-section-label" class="meta-tag"></span>
      <span id="q-topic-label" class="meta-tag"></span>
      <span id="q-difficulty-label" class="meta-tag"></span>
    </div>

    <div id="q-image-wrapper" style="display:none;">
      <img id="q-image" alt="Question image" />
    </div>

    <div id="q-text"></div>

    <div id="choices-container"></div>

    <div id="feedback" style="display:none;">
      <div id="feedback-text"></div>
      <div id="explanation" style="display:none;"></div>
    </div>

    <div id="action-buttons">
      <button id="btn-show-answer" class="btn-primary">Check Answer</button>
    </div>

    <div id="nav-buttons">
      <button id="btn-prev" class="btn-nav" disabled>&larr; Previous</button>
      <button id="btn-next" class="btn-nav">Next &rarr;</button>
    </div>
  </div>

  <!-- Summary page -->
  <div id="summary-container" style="display:none;">
    <h2>Test Complete</h2>
    <div id="summary-score"></div>
    <div id="summary-breakdown"></div>
    <button id="btn-review" class="btn-primary">Review Answers</button>
    <button id="btn-restart" class="btn-primary">Restart</button>
  </div>

  <!-- Empty state -->
  <div id="empty-state" style="display:none;">
    <p>No questions match the current filters. Try adjusting your selection.</p>
  </div>

  <!-- Extra questions link -->
  
</div>

<script>
'use strict';
(function() {

/* ---- Data ---- */
var ALL_QUESTIONS = JSON.parse('[{"question_id": "q-sec09-bac-limits-009", "question_type": "multiple_choice", "question_text": "If you drive with an illegal BAC, what can a law enforcement officer do?", "choices": [{"label": "A", "text": "Issue only a warning"}, {"label": "B", "text": "Charge you with DUI"}, {"label": "C", "text": "Require you to take a driving test"}, {"label": "D", "text": "Impound your vehicle but not arrest you"}], "correct_answer": "B", "explanation": "If you drive with an illegal BAC, a law enforcement officer can charge you with DUI. This can result in arrest, license suspension, fines, and other penalties.", "section_id": "section-09", "topic": "Blood Alcohol Concentration (BAC) Limits", "subtopic": "DUI Charges Even Below Legal Limits", "difficulty": "easy", "image_id": null, "image_file": null, "source_facts": ["If you drive with an illegal BAC, a law enforcement officer can charge you with DUI."], "validation_status": "pass", "_image_data_uri": null}, {"question_id": "q-sec09-bac-limits-016", "question_type": "multiple_choice", "question_text": "According to the BAC table notes, how much should you subtract from your BAC estimate for each 40 minutes between drinks?", "choices": [{"label": "A", "text": "0.005%"}, {"label": "B", "text": "0.01%"}, {"label": "C", "text": "0.02%"}, {"label": "D", "text": "0.05%"}], "correct_answer": "B", "explanation": "You should subtract 0.01% from the BAC estimate for each 40 minutes that lapse between drinks. This reflects the body\'s ability to metabolize alcohol over time.", "section_id": "section-09", "topic": "Blood Alcohol Concentration (BAC) Limits", "subtopic": "BAC Estimate Table and Drink Equivalencies", "difficulty": "medium", "image_id": null, "image_file": null, "source_facts": ["You should subtract 0.01% from the BAC estimate for each 40 minutes that lapse between drinks."], "validation_status": "pass", "_image_data_uri": null}, {"question_id": "q-sec09-dui-convictions-006", "question_type": "multiple_choice", "question_text": "What is the maximum jail sentence you may face if convicted of a DUI?", "choices": ["A. 30 days", "B. 3 months", "C. 6 months", "D. 1 year"], "correct_answer": "C", "explanation": "If you are convicted of DUI, you may be sentenced to up to six months in jail. This is in addition to other penalties such as fines, license suspension, and DUI program requirements.", "section_id": "section-09", "topic": "DUI Convictions", "subtopic": "Additional Penalties and DUI Record Length", "difficulty": "medium", "image_id": null, "image_file": null, "source_facts": ["If you are convicted of DUI, you may be sentenced to up to six months in jail."], "validation_status": "pass", "validation_notes": null, "_image_data_uri": null}, {"question_id": "q-sec09-drivers-under-21-003", "question_type": "multiple_choice", "question_text": "If you are under 21 and an adult 21 or older is with you, what condition must the alcohol container meet to be carried in the vehicle?", "choices": ["A. It must be in a cooler", "B. It must be in the glove box", "C. It must be full, sealed, and unopened", "D. It must be wrapped in a bag"], "correct_answer": "C", "explanation": "When an under-21 driver carries alcohol in a vehicle with an adult present, the container must be full, sealed, and unopened. If the container is opened, it must be kept in the trunk or a place where passengers do not sit.", "section_id": "section-09", "topic": "Drivers Under 21", "subtopic": "Possessing Alcohol: Carrying Alcohol in a Vehicle", "difficulty": "medium", "image_id": null, "image_file": null, "source_facts": ["For under-21 alcohol possession in a vehicle, the container must be full, sealed, and unopened."], "validation_status": "pass", "validation_notes": null, "_image_data_uri": null}, {"question_id": "q-sec09-drivers-under-21-004", "question_type": "multiple_choice", "question_text": "If you are under 21 and have an opened alcohol container in your vehicle, where must it be kept?", "choices": ["A. On the back seat", "B. In the glove box", "C. Under the driver\'s seat", "D. In the trunk or a place where passengers do not sit"], "correct_answer": "D", "explanation": "If the alcohol container is opened, you must keep it in the trunk or a place where passengers do not sit. Keeping it anywhere accessible to passengers, including the glove box or seats, is illegal.", "section_id": "section-09", "topic": "Drivers Under 21", "subtopic": "Possessing Alcohol: Carrying Alcohol in a Vehicle", "difficulty": "easy", "image_id": null, "image_file": null, "source_facts": ["If the alcohol container is opened, it must be kept in the trunk or a place where passengers do not sit."], "validation_status": "pass", "validation_notes": null, "_image_data_uri": null}, {"question_id": "q-sec09-drivers-under-21-007", "question_type": "true_false", "question_text": "If you are under 21 and caught with alcohol in your vehicle, the court may fine you and suspend your driver\'s license for one year.", "choices": ["True", "False"], "correct_answer": "True", "explanation": "If you are caught with alcohol in your vehicle as an under-21 driver, the court may fine you and suspend your driver\'s license for one year. These penalties are in addition to vehicle impoundment.", "section_id": "section-09", "topic": "Drivers Under 21", "subtopic": "Possessing Alcohol: Impound, Fines, and License Consequences", "difficulty": "medium", "image_id": null, "image_file": null, "source_facts": ["If you are caught with alcohol in your vehicle, the court may fine you.", "If you are caught with alcohol in your vehicle, the court may suspend your driver\'s license for one year."], "validation_status": "pass", "validation_notes": null, "_image_data_uri": null}, {"question_id": "q-sec09-drivers-under-21-015", "question_type": "scenario", "question_text": "Emily is 18 and does not yet have a driver\'s license. She is caught with alcohol in a friend\'s car while riding as a passenger. The court decides to penalize her. What may the court ask DMV to do?", "choices": ["A. Permanently bar her from getting a license", "B. Require her to pass an additional written test", "C. Delay giving her a first driver\'s license for up to one year", "D. Require her to complete 100 hours of community service"], "correct_answer": "C", "explanation": "If you do not already have a driver\'s license, the court may ask DMV to delay giving you your first driver\'s license for up to one year. This penalty can affect your ability to get licensed even before you apply.", "section_id": "section-09", "topic": "Drivers Under 21", "subtopic": "Possessing Alcohol: Impound, Fines, and License Consequences", "difficulty": "hard", "image_id": null, "image_file": null, "source_facts": ["If you do not already have a driver\'s license, the court may ask DMV to delay giving you your first driver\'s license for up to one year."], "validation_status": "pass", "validation_notes": null, "_image_data_uri": null}, {"question_id": "q-sec09-use-or-possession-of-alcohol-or-cannabis-007", "question_type": "true_false", "question_text": "It is legal to eat a cannabis edible while riding as a passenger in a friend\'s car.", "choices": [{"label": "True", "text": "True"}, {"label": "False", "text": "False"}], "correct_answer": "False", "explanation": "It is illegal to eat a cannabis product while you are driving or riding as a passenger in a vehicle. The exception for passengers only applies to buses, taxis, campers, and motorhomes, not to private cars.", "section_id": "section-09", "topic": "Use or Possession of Alcohol or Cannabis Products in a Vehicle", "subtopic": "Alcohol or Cannabis in a Vehicle", "difficulty": "medium", "image_id": null, "image_file": null, "source_facts": ["It is illegal to eat a cannabis product while you are driving or riding as a passenger in a vehicle."], "validation_status": "pass", "validation_notes": null, "_image_data_uri": null}, {"question_id": "q-sec09-alcohol-and-drugs-017", "question_type": "scenario", "question_text": "Maria is 65 years old and has a glass of wine with dinner before driving home. She feels fine and believes she is within the legal limit. Which statement is most accurate?", "choices": [{"label": "A", "text": "She has nothing to worry about because she only had one glass"}, {"label": "B", "text": "Her age means her tolerance to alcohol has likely decreased, increasing her risk of impaired driving"}, {"label": "C", "text": "Older drivers are immune to the effects of small amounts of alcohol"}, {"label": "D", "text": "The legal BAC limit is higher for drivers over 60"}], "correct_answer": "B", "explanation": "As you age, your tolerance to alcohol decreases, which increases the risk of alcohol-related driving problems. Even if Maria feels fine, the alcohol may be affecting her driving ability more than she realizes.", "section_id": "section-09", "topic": "Alcohol and Drugs", "subtopic": "DUI Laws Apply to Alcohol and Drugs", "difficulty": "medium", "image_id": null, "image_file": null, "source_facts": ["As you age, your tolerance to alcohol decreases.", "Decreased tolerance to alcohol increases the risk of alcohol-related driving problems."], "validation_status": "pass", "validation_notes": null, "_image_data_uri": null}, {"question_id": "q-sec09-alcohol-and-drugs-021", "question_type": "true_false", "question_text": "It is illegal to drive while under the influence of alcohol, but legal to drive under the influence of marijuana.", "choices": [{"label": "True", "text": "True"}, {"label": "False", "text": "False"}], "correct_answer": "False", "explanation": "California\'s DUI laws apply to both alcohol and drugs. It is illegal to drive while under the influence of any drug that affects your ability to drive safely, including marijuana.", "section_id": "section-09", "topic": "Alcohol and Drugs", "subtopic": "DUI Laws Apply to Alcohol and Drugs", "difficulty": "easy", "image_id": null, "image_file": null, "source_facts": ["California\'s driving under the influence (DUI) laws apply to both alcohol and drugs.", "It is illegal to drive while under the influence of any drug that affects your ability to drive safely."], "validation_status": "pass", "validation_notes": null, "_image_data_uri": null}, {"question_id": "q-sec09-bac-limits-015", "question_type": "multiple_choice", "question_text": "What are the three driving condition categories shown in the BAC estimate table?", "choices": [{"label": "A", "text": "Safe, Caution, Danger"}, {"label": "B", "text": "Only Safe Driving Limit, Driving Skills Impaired, Legally Intoxicated"}, {"label": "C", "text": "Sober, Buzzed, Drunk"}, {"label": "D", "text": "Legal, Borderline, Illegal"}], "correct_answer": "B", "explanation": "The BAC table labels driving condition categories as Only Safe Driving Limit (0 drinks, green), Driving Skills Impaired (1-3 drinks, yellow), and Legally Intoxicated (4-5 drinks, red).", "section_id": "section-09", "topic": "Blood Alcohol Concentration (BAC) Limits", "subtopic": "BAC Estimate Table and Drink Equivalencies", "difficulty": "medium", "image_id": null, "image_file": null, "source_facts": ["The BAC table labels driving condition categories as Only Safe Driving Limit, Driving Skills Impaired, and Legally Intoxicated."], "validation_status": "pass", "_image_data_uri": null}, {"question_id": "q-sec09-bac-limits-030", "question_type": "multiple_choice", "question_text": "According to the BAC estimate table, who generally has a higher estimated BAC after the same number of drinks -- a male or a female of the same body weight?", "choices": [{"label": "A", "text": "A male"}, {"label": "B", "text": "A female"}, {"label": "C", "text": "They are always the same"}, {"label": "D", "text": "It depends on the type of drink"}], "correct_answer": "B", "explanation": "According to the BAC table, females generally have a higher estimated BAC than males of the same body weight after consuming the same number of drinks. For example, a 120-pound female has a BAC of .11 after 2 drinks, while a 120-pound male has a BAC of .10. This pattern holds across most weight and drink combinations in the table.", "section_id": "section-09", "topic": "Blood Alcohol Concentration (BAC) Limits", "subtopic": "BAC Estimate Table and Drink Equivalencies", "difficulty": "medium", "image_id": null, "image_file": null, "source_facts": ["The BAC estimate table shows BAC estimates based on how many drinks are consumed, gender, and body weight."], "validation_status": "fixed", "fix_notes": "Fixed explanation to use a more illustrative example where female BAC is clearly higher than male BAC at the same weight.", "_image_data_uri": null}, {"question_id": "q-sec09-dui-convictions-003", "question_type": "multiple_choice", "question_text": "After a DUI conviction, which document must you file with the DMV?", "choices": ["A. A California Insurance Proof Certificate (SR 22/SR 1P)", "B. A vehicle inspection report", "C. A medical clearance form", "D. A court-approved driving plan"], "correct_answer": "A", "explanation": "After a DUI conviction, you must file a California Insurance Proof Certificate (SR 22/SR 1P) with the DMV. This certificate proves you carry the required auto insurance.", "section_id": "section-09", "topic": "DUI Convictions", "subtopic": "DMV Actions and Requirements After Conviction", "difficulty": "medium", "image_id": null, "image_file": null, "source_facts": ["If you are convicted of a DUI, you must file a California Insurance Proof Certificate (SR 22/SR 1P)."], "validation_status": "pass", "validation_notes": null, "_image_data_uri": null}, {"question_id": "q-sec09-dui-convictions-008", "question_type": "multiple_choice", "question_text": "If you are convicted of DUI, what may law enforcement do with your vehicle?", "choices": ["A. Sell it at auction immediately", "B. Impound it, and you may have to pay a storage fee", "C. Transfer the title to the state", "D. Place a lien on it for five years"], "correct_answer": "B", "explanation": "If you are convicted of DUI, law enforcement may impound your vehicle and you may have to pay a storage fee to get it back. This is one of several potential penalties for a DUI conviction.", "section_id": "section-09", "topic": "DUI Convictions", "subtopic": "Additional Penalties and DUI Record Length", "difficulty": "medium", "image_id": null, "image_file": null, "source_facts": ["If you are convicted of DUI, law enforcement may impound your vehicle and you may have to pay a storage fee."], "validation_status": "pass", "validation_notes": null, "_image_data_uri": null}, {"question_id": "q-sec09-alcohol-and-drugs-003", "question_type": "multiple_choice", "question_text": "As you age, what happens to your tolerance to alcohol?", "choices": [{"label": "A", "text": "It increases, making you safer to drive"}, {"label": "B", "text": "It decreases, increasing the risk of alcohol-related driving problems"}, {"label": "C", "text": "It stays the same throughout your life"}, {"label": "D", "text": "It increases until age 50, then decreases"}], "correct_answer": "B", "explanation": "As you age, your tolerance to alcohol decreases, which increases the risk of alcohol-related driving problems. Older drivers should be especially cautious about consuming alcohol before driving.", "section_id": "section-09", "topic": "Alcohol and Drugs", "subtopic": "DUI Laws Apply to Alcohol and Drugs", "difficulty": "medium", "image_id": null, "image_file": null, "source_facts": ["As you age, your tolerance to alcohol decreases.", "Decreased tolerance to alcohol increases the risk of alcohol-related driving problems."], "validation_status": "pass", "validation_notes": null, "_image_data_uri": null}, {"question_id": "q-sec09-alcohol-and-drugs-006", "question_type": "multiple_choice", "question_text": "Which of the following is TRUE about driving after taking medications?", "choices": [{"label": "A", "text": "Prescription drugs are always safe to use before driving"}, {"label": "B", "text": "Over-the-counter medications cannot impair your driving"}, {"label": "C", "text": "Both prescription and over-the-counter medications can affect your ability to drive"}, {"label": "D", "text": "Only medications that cause drowsiness can impair driving"}], "correct_answer": "C", "explanation": "It is illegal to drive after taking any drug that affects your ability to drive, and this includes both prescription and over-the-counter medications. Always read labels and know the effects of any drug you take.", "section_id": "section-09", "topic": "Alcohol and Drugs", "subtopic": "Illegal to Drive After Drinking Alcohol or Taking Drugs", "difficulty": "easy", "image_id": null, "image_file": null, "source_facts": ["No matter what age you are, it is illegal to drive after taking any drug that affects your ability to drive.", "Prescription medications can affect your ability to drive and are included in the rule.", "Over-the-counter medications can affect your ability to drive and are included in the rule."], "validation_status": "pass", "validation_notes": null, "_image_data_uri": null}, {"question_id": "q-sec09-alcohol-and-drugs-008", "question_type": "multiple_choice", "question_text": "Why should you read the labels on all medications you take?", "choices": [{"label": "A", "text": "To check the expiration date before driving"}, {"label": "B", "text": "To know the effects of any drug you use and whether it may impair your driving"}, {"label": "C", "text": "It is required by California law to read labels aloud before driving"}, {"label": "D", "text": "To determine if the medication is covered by insurance"}], "correct_answer": "B", "explanation": "You should read medication labels and know the effects of any drug you use. Some medications can impair your ability to drive safely, and you are responsible for knowing whether a drug you take could affect your driving.", "section_id": "section-09", "topic": "Alcohol and Drugs", "subtopic": "Medication Labels and Blood or Urine Tests", "difficulty": "easy", "image_id": null, "image_file": null, "source_facts": ["You should read medication labels and know the effects of any drug you use."], "validation_status": "pass", "validation_notes": null, "_image_data_uri": null}, {"question_id": "q-sec09-alcohol-and-drugs-016", "question_type": "true_false", "question_text": "The age restriction for driving after drinking alcohol applies only to drivers under 21.", "choices": [{"label": "True", "text": "True"}, {"label": "False", "text": "False"}], "correct_answer": "False", "explanation": "No matter what age you are, it is illegal to drive after drinking excessive amounts of alcohol in any form. The prohibition applies to all drivers, not just those under 21.", "section_id": "section-09", "topic": "Alcohol and Drugs", "subtopic": "Illegal to Drive After Drinking Alcohol or Taking Drugs", "difficulty": "easy", "image_id": null, "image_file": null, "source_facts": ["No matter what age you are, it is illegal to drive after drinking excessive amounts of alcohol in any form."], "validation_status": "pass", "validation_notes": null, "_image_data_uri": null}, {"question_id": "q-sec09-bac-limits-019", "question_type": "multiple_choice", "question_text": "How many ounces of 5% beer equals one standard drink according to the BAC table?", "choices": [{"label": "A", "text": "8 oz."}, {"label": "B", "text": "10 oz."}, {"label": "C", "text": "12 oz."}, {"label": "D", "text": "16 oz."}], "correct_answer": "C", "explanation": "One drink equals 12 oz. of 5% beer. This is a standard can or bottle of beer. It is also equivalent to 1.5 oz. of 80 proof liquor or 5 oz. of 12% wine.", "section_id": "section-09", "topic": "Blood Alcohol Concentration (BAC) Limits", "subtopic": "BAC Estimate Table and Drink Equivalencies", "difficulty": "medium", "image_id": null, "image_file": null, "source_facts": ["One drink is defined as 1.5 oz. of 80 proof liquor, 12 oz. of 5% beer, or 5 oz. of 12% wine."], "validation_status": "pass", "_image_data_uri": null}, {"question_id": "q-sec09-use-or-possession-of-alcohol-or-cannabis-009", "question_type": "true_false", "question_text": "It is illegal to smoke cannabis while driving, but it is legal to smoke cannabis while riding as a passenger.", "choices": [{"label": "True", "text": "True"}, {"label": "False", "text": "False"}], "correct_answer": "False", "explanation": "It is illegal to smoke a cannabis product while you are driving or riding as a passenger in a vehicle. Both the driver and passengers are prohibited from smoking cannabis in a standard vehicle.", "section_id": "section-09", "topic": "Use or Possession of Alcohol or Cannabis Products in a Vehicle", "subtopic": "Alcohol or Cannabis in a Vehicle", "difficulty": "medium", "image_id": null, "image_file": null, "source_facts": ["It is illegal to smoke a cannabis product while you are driving or riding as a passenger in a vehicle."], "validation_status": "pass", "validation_notes": null, "_image_data_uri": null}, {"question_id": "q-sec09-bac-limits-040", "question_type": "scenario", "question_text": "Maria is a 22-year-old woman who weighs 140 pounds. She had 3 glasses of wine (each glass being one standard drink) over the course of an evening. According to the BAC estimate table, what is her estimated BAC?", "choices": [{"label": "A", "text": ".11"}, {"label": "B", "text": ".13"}, {"label": "C", "text": ".14"}, {"label": "D", "text": ".17"}], "correct_answer": "C", "explanation": "According to the BAC estimate table, a female weighing 140 pounds who has consumed 3 drinks has an estimated BAC of .14. This is well above the legal limit of 0.08% for drivers over 21 and Maria should not drive.", "section_id": "section-09", "topic": "Blood Alcohol Concentration (BAC) Limits", "subtopic": "BAC Estimate Table and Drink Equivalencies", "difficulty": "medium", "image_id": null, "image_file": null, "source_facts": ["The BAC estimate table shows an estimated BAC of .14 for a female weighing 140 pounds after 3 drinks."], "validation_status": "pass", "_image_data_uri": null}, {"question_id": "q-sec09-dui-convictions-002", "question_type": "true_false", "question_text": "If you are convicted of a DUI, you must complete a DUI program.", "choices": ["True", "False"], "correct_answer": "True", "explanation": "Completing a DUI program is a mandatory requirement after a DUI conviction in California. This is one of several requirements you must fulfill to eventually restore your driving privilege.", "section_id": "section-09", "topic": "DUI Convictions", "subtopic": "DMV Actions and Requirements After Conviction", "difficulty": "easy", "image_id": null, "image_file": null, "source_facts": ["If you are convicted of a DUI, you must complete a DUI program."], "validation_status": "pass", "validation_notes": null, "_image_data_uri": null}, {"question_id": "q-sec09-alcohol-and-drugs-015", "question_type": "true_false", "question_text": "California DUI laws treat illegal drugs differently from prescription medications when determining impairment.", "choices": [{"label": "True", "text": "True"}, {"label": "False", "text": "False"}], "correct_answer": "False", "explanation": "The law does not see a difference between illegal drugs and medications you get from a doctor or pharmacy. Both can affect your ability to drive safely, and both are treated the same under California DUI law.", "section_id": "section-09", "topic": "Alcohol and Drugs", "subtopic": "DUI Laws Apply to Alcohol and Drugs", "difficulty": "medium", "image_id": null, "image_file": null, "source_facts": ["The law does not see a difference between illegal drugs and medications you get from a doctor or pharmacy for purposes of impairment."], "validation_status": "pass", "validation_notes": null, "_image_data_uri": null}, {"question_id": "q-sec09-bac-limits-036", "question_type": "true_false", "question_text": "It is illegal to drink alcohol when operating a jet ski in California.", "choices": [{"label": "True", "text": "True"}, {"label": "False", "text": "False"}], "correct_answer": "True", "explanation": "This is true. It is illegal to drink alcohol or take drugs when you are operating a boat, jet ski, water skis, aquaplane, or similar vessels in California.", "section_id": "section-09", "topic": "Blood Alcohol Concentration (BAC) Limits", "subtopic": "NOTE: Alcohol or Drugs While Operating Vessels", "difficulty": "easy", "image_id": null, "image_file": null, "source_facts": ["It is illegal to drink alcohol when you are operating a boat, jet ski, water skis, aquaplane, or similar vessels."], "validation_status": "pass", "_image_data_uri": null}, {"question_id": "q-sec09-alcohol-and-drugs-019", "question_type": "scenario", "question_text": "A 17-year-old is stopped by police while riding a bicycle after drinking beer at a friend\'s house. If convicted, what could happen to the teenager\'s driving privilege?", "choices": [{"label": "A", "text": "Nothing, because the teen was on a bicycle, not in a car"}, {"label": "B", "text": "The teen\'s driving privilege may be suspended or delayed for one year"}, {"label": "C", "text": "The teen will lose the right to ride a bicycle for six months"}, {"label": "D", "text": "The teen must retake the driving knowledge test"}], "correct_answer": "B", "explanation": "If you are 13 to 20 years old and convicted of operating a bicycle while under the influence of alcohol or drugs, your driving privilege may be suspended or delayed for one year once you are eligible to drive.", "section_id": "section-09", "topic": "Alcohol and Drugs", "subtopic": "IMPORTANT: Bicycle DUI (Ages 13–20)", "difficulty": "hard", "image_id": null, "image_file": null, "source_facts": ["If you are 13 to 20 years old and convicted of operating a bicycle while under the influence of alcohol or drugs, your driving privilege may be suspended or delayed for one year once you are eligible to drive."], "validation_status": "pass", "validation_notes": null, "_image_data_uri": null}, {"question_id": "q-sec09-bac-limits-020", "question_type": "multiple_choice", "question_text": "How many ounces of 12% wine equals one standard drink according to the BAC table?", "choices": [{"label": "A", "text": "3 oz."}, {"label": "B", "text": "5 oz."}, {"label": "C", "text": "8 oz."}, {"label": "D", "text": "10 oz."}], "correct_answer": "B", "explanation": "One drink equals 5 oz. of 12% wine. This is about one standard wine glass. It is also equivalent to 1.5 oz. of 80 proof liquor or 12 oz. of 5% beer.", "section_id": "section-09", "topic": "Blood Alcohol Concentration (BAC) Limits", "subtopic": "BAC Estimate Table and Drink Equivalencies", "difficulty": "medium", "image_id": null, "image_file": null, "source_facts": ["One drink is defined as 1.5 oz. of 80 proof liquor, 12 oz. of 5% beer, or 5 oz. of 12% wine."], "validation_status": "pass", "_image_data_uri": null}, {"question_id": "q-sec09-bac-limits-021", "question_type": "true_false", "question_text": "According to the BAC table, lighter individuals reach higher BAC estimates than heavier individuals after consuming the same number of drinks.", "choices": [{"label": "True", "text": "True"}, {"label": "False", "text": "False"}], "correct_answer": "True", "explanation": "This is true. The BAC table shows that lighter individuals reach higher BAC estimates than heavier individuals after consuming the same number of drinks. For example, a 100-pound male after 2 drinks has a BAC of .12, while a 240-pound male has a BAC of .05.", "section_id": "section-09", "topic": "Blood Alcohol Concentration (BAC) Limits", "subtopic": "BAC Estimate Table and Drink Equivalencies", "difficulty": "easy", "image_id": null, "image_file": null, "source_facts": ["The BAC table shows that lighter individuals reach higher BAC estimates than heavier individuals after consuming the same number of drinks."], "validation_status": "pass", "_image_data_uri": null}, {"question_id": "q-sec09-use-or-possession-of-alcohol-or-cannabis-004", "question_type": "true_false", "question_text": "It is legal to keep an open container of alcohol in your glove box while driving.", "choices": [{"label": "True", "text": "True"}, {"label": "False", "text": "False"}], "correct_answer": "False", "explanation": "It is specifically illegal to keep an open container of alcohol in your glove box. Open containers must be stored in the trunk or a place where passengers do not sit.", "section_id": "section-09", "topic": "Use or Possession of Alcohol or Cannabis Products in a Vehicle", "subtopic": "Alcohol or Cannabis in a Vehicle", "difficulty": "easy", "image_id": null, "image_file": null, "source_facts": ["It is illegal to keep an open container of alcohol in your glove box."], "validation_status": "pass", "validation_notes": null, "_image_data_uri": null}, {"question_id": "q-sec09-use-or-possession-of-alcohol-or-cannabis-010", "question_type": "scenario", "question_text": "You are a passenger riding in a camper and want to have a beer during the road trip. Is this legal?", "choices": [{"label": "A", "text": "No, drinking alcohol is illegal for all vehicle passengers"}, {"label": "B", "text": "Yes, the open-container rule does not apply to passengers in campers"}, {"label": "C", "text": "Only if the camper is parked and not moving"}, {"label": "D", "text": "Only if you are over 21 and have a designated driver"}], "correct_answer": "B", "explanation": "The vehicle open-container rule does not apply if you are a passenger in a bus, taxi, camper, or motorhome. As a passenger in a camper, you are exempt from this particular restriction.", "section_id": "section-09", "topic": "Use or Possession of Alcohol or Cannabis Products in a Vehicle", "subtopic": "Alcohol or Cannabis in a Vehicle", "difficulty": "hard", "image_id": null, "image_file": null, "source_facts": ["The vehicle open-container rule in this section does not apply if you are a passenger in a bus, taxi, camper, or motorhome."], "validation_status": "pass", "validation_notes": null, "_image_data_uri": null}, {"question_id": "q-sec09-bac-limits-010", "question_type": "true_false", "question_text": "Almost everyone feels negative effects of alcohol, even at levels lower than the legal limit.", "choices": [{"label": "True", "text": "True"}, {"label": "False", "text": "False"}], "correct_answer": "True", "explanation": "This is true. Almost everyone feels negative effects of alcohol, even at levels lower than the legal limit. That is why having a BAC below the legal limit does not guarantee safe driving.", "section_id": "section-09", "topic": "Blood Alcohol Concentration (BAC) Limits", "subtopic": "DUI Charges Even Below Legal Limits", "difficulty": "easy", "image_id": null, "image_file": null, "source_facts": ["Almost everyone feels negative effects of alcohol, even at levels lower than the legal limit."], "validation_status": "pass", "_image_data_uri": null}, {"question_id": "q-sec09-drivers-under-21-011", "question_type": "true_false", "question_text": "If you are under 21 and convicted of a DUI with a BAC of 0.01% or higher, you must complete a licensed DUI program.", "choices": ["True", "False"], "correct_answer": "True", "explanation": "If you are under 21 and convicted of a DUI with a BAC of 0.01% or higher, you must complete a licensed DUI program in addition to the potential revocation of your driving privilege for one year.", "section_id": "section-09", "topic": "Drivers Under 21", "subtopic": "Consuming Alcohol: DUI Conviction at 0.01% BAC (Under 21)", "difficulty": "easy", "image_id": null, "image_file": null, "source_facts": ["If you are convicted of a DUI with a BAC of 0.01% or higher, you must also complete a licensed DUI program (as stated here)."], "validation_status": "pass", "validation_notes": null, "_image_data_uri": null}, {"question_id": "q-sec09-alcohol-and-drugs-013", "question_type": "multiple_choice", "question_text": "The bicycle DUI rule that can affect your driving privilege applies to individuals in which age range?", "choices": [{"label": "A", "text": "Under 18 years old"}, {"label": "B", "text": "13 to 20 years old"}, {"label": "C", "text": "16 to 21 years old"}, {"label": "D", "text": "Any age"}], "correct_answer": "B", "explanation": "The rule applies specifically to individuals who are 13 to 20 years old. A conviction for operating a bicycle under the influence in this age range may result in a one-year suspension or delay of driving privileges.", "section_id": "section-09", "topic": "Alcohol and Drugs", "subtopic": "IMPORTANT: Bicycle DUI (Ages 13–20)", "difficulty": "hard", "image_id": null, "image_file": null, "source_facts": ["If you are 13 to 20 years old and convicted of operating a bicycle while under the influence of alcohol or drugs, your driving privilege may be suspended or delayed for one year once you are eligible to drive."], "validation_status": "pass", "validation_notes": null, "_image_data_uri": null}, {"question_id": "q-sec09-bac-limits-045", "question_type": "true_false", "question_text": "It is legal to take drugs while operating water skis in California.", "choices": [{"label": "True", "text": "True"}, {"label": "False", "text": "False"}], "correct_answer": "False", "explanation": "This is false. It is illegal to drink alcohol or take drugs when you are operating a boat, jet ski, water skis, aquaplane, or similar vessels in California.", "section_id": "section-09", "topic": "Blood Alcohol Concentration (BAC) Limits", "subtopic": "NOTE: Alcohol or Drugs While Operating Vessels", "difficulty": "easy", "image_id": null, "image_file": null, "source_facts": ["It is illegal to take drugs when you are operating a boat, jet ski, water skis, aquaplane, or similar vessels."], "validation_status": "pass", "_image_data_uri": null}, {"question_id": "q-sec09-dui-convictions-011", "question_type": "true_false", "question_text": "If you receive another DUI within the 10-year period that a previous DUI conviction remains on your record, the court or DMV may impose an additional penalty.", "choices": ["True", "False"], "correct_answer": "True", "explanation": "All DUI convictions remain on your driver\'s record for 10 years. If you get any other DUIs during that time, the court or DMV may give you an additional penalty, which can include longer suspensions and more severe consequences.", "section_id": "section-09", "topic": "DUI Convictions", "subtopic": "Additional Penalties and DUI Record Length", "difficulty": "easy", "image_id": null, "image_file": null, "source_facts": ["If you get any other DUIs during the 10-year period, the court or DMV may give you an additional penalty."], "validation_status": "pass", "validation_notes": null, "_image_data_uri": null}, {"question_id": "q-sec09-drivers-under-21-005", "question_type": "true_false", "question_text": "If you are under 21 and working for someone with an off-site liquor sales license, you may carry alcoholic beverages in closed containers.", "choices": ["True", "False"], "correct_answer": "True", "explanation": "There is an exception to the under-21 alcohol possession rules: if you are working for someone with an off-site liquor sales license, you may carry alcoholic beverages in closed containers as part of your job duties.", "section_id": "section-09", "topic": "Drivers Under 21", "subtopic": "Possessing Alcohol: Carrying Alcohol in a Vehicle", "difficulty": "hard", "image_id": null, "image_file": null, "source_facts": ["If you are working for someone with an off-site liquor sales license, you may carry alcoholic beverages in closed containers (exception stated here)."], "validation_status": "pass", "validation_notes": null, "_image_data_uri": null}, {"question_id": "q-sec09-use-or-possession-of-alcohol-or-cannabis-006", "question_type": "true_false", "question_text": "It is legal for a passenger in a taxi to drink alcohol while riding in the vehicle.", "choices": [{"label": "True", "text": "True"}, {"label": "False", "text": "False"}], "correct_answer": "True", "explanation": "The vehicle open-container rule does not apply if you are a passenger in a bus, taxi, camper, or motorhome. Therefore, a passenger in a taxi is exempt from this particular restriction.", "section_id": "section-09", "topic": "Use or Possession of Alcohol or Cannabis Products in a Vehicle", "subtopic": "Alcohol or Cannabis in a Vehicle", "difficulty": "hard", "image_id": null, "image_file": null, "source_facts": ["The vehicle open-container rule in this section does not apply if you are a passenger in a bus, taxi, camper, or motorhome."], "validation_status": "pass", "validation_notes": null, "_image_data_uri": null}, {"question_id": "q-sec09-bac-limits-038", "question_type": "multiple_choice", "question_text": "Refer to the BAC table image. What color coding is used for the \'Legally Intoxicated\' category?", "choices": [{"label": "A", "text": "Green"}, {"label": "B", "text": "Yellow"}, {"label": "C", "text": "Red"}, {"label": "D", "text": "Orange"}], "correct_answer": "C", "explanation": "The BAC table uses color coding to indicate driving conditions: green for \'Only Safe Driving Limit\' (0 drinks), yellow for \'Driving Skills Impaired\' (1-3 drinks), and red for \'Legally Intoxicated\' (4-5 drinks).", "section_id": "section-09", "topic": "Blood Alcohol Concentration (BAC) Limits", "subtopic": "BAC Estimate Table and Drink Equivalencies", "difficulty": "medium", "image_id": "sec09-p02-img01", "image_file": null, "source_facts": ["The BAC table labels driving condition categories as Only Safe Driving Limit, Driving Skills Impaired, and Legally Intoxicated."], "validation_status": "pass", "_image_data_uri": null}, {"question_id": "q-sec09-dui-convictions-007", "question_type": "true_false", "question_text": "If you are convicted of DUI, you may have to pay a fine.", "choices": ["True", "False"], "correct_answer": "True", "explanation": "Fines are one of the additional penalties you may face if convicted of DUI. Penalties can also include jail time, vehicle impoundment, and civil lawsuits if injury or death results.", "section_id": "section-09", "topic": "DUI Convictions", "subtopic": "Additional Penalties and DUI Record Length", "difficulty": "easy", "image_id": null, "image_file": null, "source_facts": ["If you are convicted of DUI, you may have to pay a fine."], "validation_status": "pass", "validation_notes": null, "_image_data_uri": null}, {"question_id": "q-sec09-dui-convictions-005", "question_type": "true_false", "question_text": "After a DUI conviction, you must pay any applicable license reissue or restriction fees.", "choices": ["True", "False"], "correct_answer": "True", "explanation": "Paying applicable license reissue or restriction fees is one of the requirements after a DUI conviction. Along with completing a DUI program and filing proof of insurance, these fees must be paid to restore your driving privilege.", "section_id": "section-09", "topic": "DUI Convictions", "subtopic": "DMV Actions and Requirements After Conviction", "difficulty": "easy", "image_id": null, "image_file": null, "source_facts": ["If you are convicted of a DUI, you must pay any applicable license reissue or restriction fees."], "validation_status": "pass", "validation_notes": null, "_image_data_uri": null}, {"question_id": "q-sec09-bac-limits-002", "question_type": "true_false", "question_text": "When you consume alcohol, traces of it enter your bloodstream.", "choices": [{"label": "True", "text": "True"}, {"label": "False", "text": "False"}], "correct_answer": "True", "explanation": "This is true. When you consume alcohol, traces of it enter your bloodstream, which is what a BAC test detects.", "section_id": "section-09", "topic": "Blood Alcohol Concentration (BAC) Limits", "subtopic": "What BAC Measures", "difficulty": "easy", "image_id": null, "image_file": null, "source_facts": ["When you consume alcohol, traces of it enter your bloodstream."], "validation_status": "pass", "_image_data_uri": null}, {"question_id": "q-sec09-bac-limits-039", "question_type": "multiple_choice", "question_text": "Refer to the BAC table image. What symbol appears at the top-left of the table?", "choices": [{"label": "A", "text": "A green check mark over a steering wheel"}, {"label": "B", "text": "A red circle-and-slash symbol over a black drink glass"}, {"label": "C", "text": "A yellow warning triangle"}, {"label": "D", "text": "A blue information circle with a car"}], "correct_answer": "B", "explanation": "The BAC table features a red circle-and-slash symbol over a black drink glass at the top-left, which is a universal \'no alcohol\' symbol reinforcing the message that drinking and driving is prohibited.", "section_id": "section-09", "topic": "Blood Alcohol Concentration (BAC) Limits", "subtopic": "BAC Estimate Table and Drink Equivalencies", "difficulty": "medium", "image_id": "sec09-p02-img01", "image_file": null, "source_facts": ["The BAC estimate table shows BAC estimates based on how many drinks are consumed, gender, and body weight."], "validation_status": "pass", "_image_data_uri": null}, {"question_id": "q-sec09-bac-limits-022", "question_type": "true_false", "question_text": "Fewer than 5 persons out of 100 will exceed the BAC table values.", "choices": [{"label": "True", "text": "True"}, {"label": "False", "text": "False"}], "correct_answer": "True", "explanation": "This is true. The BAC table note states that fewer than 5 persons out of 100 will exceed these values. This means the table provides a reasonable estimate for the vast majority of people.", "section_id": "section-09", "topic": "Blood Alcohol Concentration (BAC) Limits", "subtopic": "BAC Estimate Table and Drink Equivalencies", "difficulty": "hard", "image_id": null, "image_file": null, "source_facts": ["Fewer than 5 persons out of 100 will exceed the BAC table values."], "validation_status": "pass", "_image_data_uri": null}, {"question_id": "q-sec09-bac-limits-023", "question_type": "multiple_choice", "question_text": "According to the BAC estimate table, what is the estimated BAC for a 160-pound male who has had 3 drinks?", "choices": [{"label": "A", "text": ".09"}, {"label": "B", "text": ".11"}, {"label": "C", "text": ".13"}, {"label": "D", "text": ".15"}], "correct_answer": "B", "explanation": "According to the BAC estimate table, a 160-pound male who has consumed 3 drinks has an estimated BAC of .11. This places him in the \'Legally Intoxicated\' range, well above the 0.08% legal limit.", "section_id": "section-09", "topic": "Blood Alcohol Concentration (BAC) Limits", "subtopic": "BAC Estimate Table and Drink Equivalencies", "difficulty": "medium", "image_id": null, "image_file": null, "source_facts": ["The BAC estimate table shows an estimated BAC of .11 for a male weighing 160 pounds after 3 drinks."], "validation_status": "pass", "_image_data_uri": null}, {"question_id": "q-sec09-bac-limits-027", "question_type": "multiple_choice", "question_text": "According to the BAC estimate table, what is the estimated BAC for a 180-pound male who has had 2 drinks?", "choices": [{"label": "A", "text": ".05"}, {"label": "B", "text": ".06"}, {"label": "C", "text": ".07"}, {"label": "D", "text": ".09"}], "correct_answer": "C", "explanation": "According to the BAC estimate table, a 180-pound male who has consumed 2 drinks has an estimated BAC of .07. Although this is below the legal limit of 0.08%, his driving skills are still impaired.", "section_id": "section-09", "topic": "Blood Alcohol Concentration (BAC) Limits", "subtopic": "BAC Estimate Table and Drink Equivalencies", "difficulty": "medium", "image_id": null, "image_file": null, "source_facts": ["The BAC estimate table shows an estimated BAC of .07 for a male weighing 180 pounds after 2 drinks."], "validation_status": "pass", "_image_data_uri": null}, {"question_id": "q-sec09-bac-limits-034", "question_type": "multiple_choice", "question_text": "The BAC estimate table includes body weight columns for which range of weights?", "choices": [{"label": "A", "text": "80 to 200 pounds"}, {"label": "B", "text": "100 to 240 pounds"}, {"label": "C", "text": "100 to 220 pounds"}, {"label": "D", "text": "120 to 260 pounds"}], "correct_answer": "B", "explanation": "The BAC table includes body weight columns for 100, 120, 140, 160, 180, 200, 220, and 240 pounds, covering a range from 100 to 240 pounds.", "section_id": "section-09", "topic": "Blood Alcohol Concentration (BAC) Limits", "subtopic": "BAC Estimate Table and Drink Equivalencies", "difficulty": "medium", "image_id": null, "image_file": null, "source_facts": ["The BAC table includes body weight columns for 100, 120, 140, 160, 180, 200, 220, and 240 pounds."], "validation_status": "pass", "_image_data_uri": null}, {"question_id": "q-sec09-bac-limits-035", "question_type": "multiple_choice", "question_text": "The BAC estimate table includes rows for how many drinks (from minimum to maximum)?", "choices": [{"label": "A", "text": "0 through 3 drinks"}, {"label": "B", "text": "1 through 5 drinks"}, {"label": "C", "text": "0 through 5 drinks"}, {"label": "D", "text": "1 through 6 drinks"}], "correct_answer": "C", "explanation": "The BAC table includes rows for 0 through 5 drinks. The 0-drink row shows a BAC of .00 for all weights and both genders, establishing the baseline.", "section_id": "section-09", "topic": "Blood Alcohol Concentration (BAC) Limits", "subtopic": "BAC Estimate Table and Drink Equivalencies", "difficulty": "easy", "image_id": null, "image_file": null, "source_facts": ["The BAC table includes rows for 0 through 5 drinks."], "validation_status": "pass", "_image_data_uri": null}, {"question_id": "q-sec09-bac-limits-024", "question_type": "multiple_choice", "question_text": "According to the BAC estimate table, what is the estimated BAC for a 120-pound female who has had 2 drinks?", "choices": [{"label": "A", "text": ".09"}, {"label": "B", "text": ".10"}, {"label": "C", "text": ".11"}, {"label": "D", "text": ".13"}], "correct_answer": "C", "explanation": "According to the BAC estimate table, a 120-pound female who has consumed 2 drinks has an estimated BAC of .11. This is above the 0.08% legal limit for drivers over 21.", "section_id": "section-09", "topic": "Blood Alcohol Concentration (BAC) Limits", "subtopic": "BAC Estimate Table and Drink Equivalencies", "difficulty": "medium", "image_id": null, "image_file": null, "source_facts": ["The BAC estimate table shows an estimated BAC of .11 for a female weighing 120 pounds after 2 drinks."], "validation_status": "pass", "_image_data_uri": null}, {"question_id": "q-sec09-bac-limits-025", "question_type": "multiple_choice", "question_text": "According to the BAC estimate table, what is the estimated BAC for a 200-pound male who has had 4 drinks?", "choices": [{"label": "A", "text": ".10"}, {"label": "B", "text": ".12"}, {"label": "C", "text": ".14"}, {"label": "D", "text": ".15"}], "correct_answer": "B", "explanation": "According to the BAC estimate table, a 200-pound male who has consumed 4 drinks has an estimated BAC of .12. Despite being a heavier individual, 4 drinks still puts him well above the legal limit.", "section_id": "section-09", "topic": "Blood Alcohol Concentration (BAC) Limits", "subtopic": "BAC Estimate Table and Drink Equivalencies", "difficulty": "medium", "image_id": null, "image_file": null, "source_facts": ["The BAC estimate table shows an estimated BAC of .12 for a male weighing 200 pounds after 4 drinks."], "validation_status": "pass", "_image_data_uri": null}, {"question_id": "q-sec09-bac-limits-026", "question_type": "multiple_choice", "question_text": "According to the BAC estimate table, what is the estimated BAC for a 100-pound female who has had 5 drinks?", "choices": [{"label": "A", "text": ".28"}, {"label": "B", "text": ".30"}, {"label": "C", "text": ".33"}, {"label": "D", "text": ".35"}], "correct_answer": "C", "explanation": "According to the BAC estimate table, a 100-pound female who has consumed 5 drinks has an estimated BAC of .33, which is the highest value in the entire table. This is more than four times the legal limit of 0.08%.", "section_id": "section-09", "topic": "Blood Alcohol Concentration (BAC) Limits", "subtopic": "BAC Estimate Table and Drink Equivalencies", "difficulty": "hard", "image_id": null, "image_file": null, "source_facts": ["The BAC estimate table shows an estimated BAC of .33 for a female weighing 100 pounds after 5 drinks."], "validation_status": "pass", "_image_data_uri": null}, {"question_id": "q-sec09-bac-limits-028", "question_type": "multiple_choice", "question_text": "According to the BAC estimate table, what is the estimated BAC for a 140-pound female who has had 4 drinks?", "choices": [{"label": "A", "text": ".15"}, {"label": "B", "text": ".17"}, {"label": "C", "text": ".19"}, {"label": "D", "text": ".22"}], "correct_answer": "C", "explanation": "According to the BAC estimate table, a 140-pound female who has consumed 4 drinks has an estimated BAC of .19. This is far above the legal limit of 0.08% and places her in the \'Legally Intoxicated\' category.", "section_id": "section-09", "topic": "Blood Alcohol Concentration (BAC) Limits", "subtopic": "BAC Estimate Table and Drink Equivalencies", "difficulty": "hard", "image_id": null, "image_file": null, "source_facts": ["The BAC estimate table shows an estimated BAC of .19 for a female weighing 140 pounds after 4 drinks."], "validation_status": "pass", "_image_data_uri": null}, {"question_id": "q-sec09-bac-limits-029", "question_type": "multiple_choice", "question_text": "According to the BAC estimate table, what is the estimated BAC for a 240-pound male who has had 5 drinks?", "choices": [{"label": "A", "text": ".10"}, {"label": "B", "text": ".12"}, {"label": "C", "text": ".14"}, {"label": "D", "text": ".15"}], "correct_answer": "B", "explanation": "According to the BAC estimate table, a 240-pound male who has consumed 5 drinks has an estimated BAC of .12. Even at the heaviest weight in the table, 5 drinks still puts this person well above the legal limit.", "section_id": "section-09", "topic": "Blood Alcohol Concentration (BAC) Limits", "subtopic": "BAC Estimate Table and Drink Equivalencies", "difficulty": "hard", "image_id": null, "image_file": null, "source_facts": ["The BAC estimate table shows an estimated BAC of .12 for a male weighing 240 pounds after 5 drinks."], "validation_status": "pass", "_image_data_uri": null}, {"question_id": "q-sec09-bac-limits-031", "question_type": "multiple_choice", "question_text": "According to the BAC estimate table, what is the estimated BAC for a 220-pound male who has had 1 drink?", "choices": [{"label": "A", "text": ".02"}, {"label": "B", "text": ".03"}, {"label": "C", "text": ".04"}, {"label": "D", "text": ".05"}], "correct_answer": "B", "explanation": "According to the BAC estimate table, a 220-pound male who has consumed 1 drink has an estimated BAC of .03. Even though this is below the 0.08% legal limit, the table classifies the driving condition as \'Driving Skills Impaired.\'", "section_id": "section-09", "topic": "Blood Alcohol Concentration (BAC) Limits", "subtopic": "BAC Estimate Table and Drink Equivalencies", "difficulty": "medium", "image_id": null, "image_file": null, "source_facts": ["The BAC estimate table shows an estimated BAC of .03 for a male weighing 220 pounds after 1 drinks."], "validation_status": "pass", "_image_data_uri": null}, {"question_id": "q-sec09-bac-limits-032", "question_type": "multiple_choice", "question_text": "According to the BAC estimate table, what is the estimated BAC for a 100-pound male who has had 2 drinks?", "choices": [{"label": "A", "text": ".08"}, {"label": "B", "text": ".10"}, {"label": "C", "text": ".12"}, {"label": "D", "text": ".14"}], "correct_answer": "C", "explanation": "According to the BAC estimate table, a 100-pound male who has consumed 2 drinks has an estimated BAC of .12. At a low body weight, even 2 drinks can result in a BAC well above the legal limit.", "section_id": "section-09", "topic": "Blood Alcohol Concentration (BAC) Limits", "subtopic": "BAC Estimate Table and Drink Equivalencies", "difficulty": "hard", "image_id": null, "image_file": null, "source_facts": ["The BAC estimate table shows an estimated BAC of .12 for a male weighing 100 pounds after 2 drinks."], "validation_status": "pass", "_image_data_uri": null}, {"question_id": "q-sec09-bac-limits-033", "question_type": "multiple_choice", "question_text": "According to the BAC estimate table, what is the estimated BAC for a 160-pound female who has had 5 drinks?", "choices": [{"label": "A", "text": ".17"}, {"label": "B", "text": ".19"}, {"label": "C", "text": ".21"}, {"label": "D", "text": ".24"}], "correct_answer": "C", "explanation": "According to the BAC estimate table, a 160-pound female who has consumed 5 drinks has an estimated BAC of .21. This is nearly three times the legal limit of 0.08%.", "section_id": "section-09", "topic": "Blood Alcohol Concentration (BAC) Limits", "subtopic": "BAC Estimate Table and Drink Equivalencies", "difficulty": "hard", "image_id": null, "image_file": null, "source_facts": ["The BAC estimate table shows an estimated BAC of .21 for a female weighing 160 pounds after 5 drinks."], "validation_status": "pass", "_image_data_uri": null}]');

/* ---- State ---- */
var filtered = [];       // Current filtered/shuffled question list (indices into ALL_QUESTIONS)
var currentIdx = 0;      // Index into filtered[]
var answers = {};        // questionIndex -> selected choice index
var revealed = {};       // questionIndex -> true if answer was revealed

/* ---- DOM refs ---- */
var $counter = document.getElementById('q-counter');
var $sectionLabel = document.getElementById('q-section-label');
var $topicLabel = document.getElementById('q-topic-label');
var $difficultyLabel = document.getElementById('q-difficulty-label');
var $imageWrapper = document.getElementById('q-image-wrapper');
var $image = document.getElementById('q-image');
var $text = document.getElementById('q-text');
var $choices = document.getElementById('choices-container');
var $feedback = document.getElementById('feedback');
var $feedbackText = document.getElementById('feedback-text');
var $explanation = document.getElementById('explanation');
var $btnShow = document.getElementById('btn-show-answer');
var $btnPrev = document.getElementById('btn-prev');
var $btnNext = document.getElementById('btn-next');
var $progressBar = document.getElementById('progress-bar');
var $scoreCorrect = document.getElementById('score-correct');
var $scoreIncorrect = document.getElementById('score-incorrect');
var $scoreUnanswered = document.getElementById('score-unanswered');
var $questionContainer = document.getElementById('question-container');
var $summaryContainer = document.getElementById('summary-container');
var $emptyState = document.getElementById('empty-state');
var $filterSection = document.getElementById('filter-section');
var $filterTopic = document.getElementById('filter-topic');
var $filterDifficulty = document.getElementById('filter-difficulty');
var $filterType = document.getElementById('filter-type');
var $btnShuffle = document.getElementById('btn-shuffle');
var $btnReset = document.getElementById('btn-reset');

/* ---- Helpers ---- */
function escapeHtml(str) {
  var div = document.createElement('div');
  div.appendChild(document.createTextNode(str || ''));
  return div.innerHTML;
}

function getField(q, names, fallback) {
  for (var i = 0; i < names.length; i++) {
    if (q[names[i]] !== undefined && q[names[i]] !== null && q[names[i]] !== '') return q[names[i]];
  }
  return fallback || '';
}

function getSection(q) { return getField(q, ['section', 'section_id', 'section_title'], 'Unknown'); }
function getTopic(q) { return getField(q, ['topic', 'topic_title', 'topic_id'], ''); }
function getDifficulty(q) { return getField(q, ['difficulty', 'difficulty_level'], ''); }
function getType(q) { return getField(q, ['question_type', 'type'], 'multiple_choice'); }
function getQuestionText(q) { return getField(q, ['question_text', 'question', 'text'], ''); }
function getExplanation(q) { return getField(q, ['explanation', 'rationale', 'answer_explanation'], ''); }

function getChoices(q) {
  // Choices may be an array of strings or an array of objects with label/text keys.
  var raw = q.choices || q.options || q.answers || [];
  var result = [];
  for (var i = 0; i < raw.length; i++) {
    var c = raw[i];
    if (typeof c === 'string') {
      result.push(c);
    } else if (c && typeof c === 'object') {
      result.push(c.text || c.label || c.value || c.choice || JSON.stringify(c));
    } else {
      result.push(String(c));
    }
  }
  // For true_false questions with no explicit choices, supply them.
  if (result.length === 0 && getType(q) === 'true_false') {
    result = ['True', 'False'];
  }
  return result;
}

function getCorrectIndex(q) {
  // correct_answer may be an index (int), a letter (A/B/C/D), or the answer text.
  var ca = q.correct_answer !== undefined ? q.correct_answer : (q.answer !== undefined ? q.answer : null);
  if (ca === null || ca === undefined) return -1;
  var choices = getChoices(q);
  // Integer index
  if (typeof ca === 'number') return ca;
  var s = String(ca).trim();
  // Single letter A-Z
  if (/^[A-Za-z]$/.test(s)) {
    var idx = s.toUpperCase().charCodeAt(0) - 65;
    if (idx >= 0 && idx < choices.length) return idx;
  }
  // Letter with parentheses or period: "A)" or "A."
  var letterMatch = s.match(/^([A-Za-z])[\).:\s]/);
  if (letterMatch) {
    var li = letterMatch[1].toUpperCase().charCodeAt(0) - 65;
    if (li >= 0 && li < choices.length) return li;
  }
  // Exact text match
  for (var i = 0; i < choices.length; i++) {
    if (choices[i].trim() === s) return i;
  }
  // Substring match (correct_answer text contained in a choice)
  for (var j = 0; j < choices.length; j++) {
    if (choices[j].toLowerCase().indexOf(s.toLowerCase()) !== -1) return j;
    if (s.toLowerCase().indexOf(choices[j].toLowerCase()) !== -1) return j;
  }
  // Numeric string
  var num = parseInt(s, 10);
  if (!isNaN(num) && num >= 0 && num < choices.length) return num;
  return -1;
}

/* ---- Filter population ---- */
function populateFilters() {
  var sections = {}, topics = {}, difficulties = {}, types = {};
  for (var i = 0; i < ALL_QUESTIONS.length; i++) {
    var q = ALL_QUESTIONS[i];
    var s = getSection(q); if (s) sections[s] = true;
    var t = getTopic(q); if (t) topics[t] = true;
    var d = getDifficulty(q); if (d) difficulties[d] = true;
    var tp = getType(q); if (tp) types[tp] = true;
  }
  fillSelect($filterSection, sections);
  fillSelect($filterTopic, topics);
  fillSelect($filterDifficulty, difficulties);
  fillSelect($filterType, types);
}

function fillSelect(el, map) {
  var keys = Object.keys(map).sort();
  for (var i = 0; i < keys.length; i++) {
    var opt = document.createElement('option');
    opt.value = keys[i];
    opt.textContent = keys[i];
    el.appendChild(opt);
  }
}

/* ---- Filtering ---- */
function applyFilters() {
  var sv = $filterSection.value;
  var tv = $filterTopic.value;
  var dv = $filterDifficulty.value;
  var tpv = $filterType.value;
  filtered = [];
  for (var i = 0; i < ALL_QUESTIONS.length; i++) {
    var q = ALL_QUESTIONS[i];
    if (sv !== 'all' && getSection(q) !== sv) continue;
    if (tv !== 'all' && getTopic(q) !== tv) continue;
    if (dv !== 'all' && getDifficulty(q) !== dv) continue;
    if (tpv !== 'all' && getType(q) !== tpv) continue;
    filtered.push(i);
  }
  currentIdx = 0;
  updateView();
}

/* ---- Shuffle ---- */
function shuffleArray(arr) {
  for (var i = arr.length - 1; i > 0; i--) {
    var j = Math.floor(Math.random() * (i + 1));
    var tmp = arr[i]; arr[i] = arr[j]; arr[j] = tmp;
  }
}

/* ---- Score calculation ---- */
function calcScores() {
  var correct = 0, incorrect = 0, unanswered = 0;
  for (var i = 0; i < filtered.length; i++) {
    var qi = filtered[i];
    if (revealed[qi] && answers[qi] !== undefined) {
      var q = ALL_QUESTIONS[qi];
      if (answers[qi] === getCorrectIndex(q)) correct++;
      else incorrect++;
    } else {
      unanswered++;
    }
  }
  return { correct: correct, incorrect: incorrect, unanswered: unanswered, total: filtered.length };
}

function updateScoreDisplay() {
  var s = calcScores();
  $scoreCorrect.textContent = 'Correct: ' + s.correct;
  $scoreIncorrect.textContent = 'Incorrect: ' + s.incorrect;
  $scoreUnanswered.textContent = 'Remaining: ' + s.unanswered;
  // Progress bar: answered / total
  var pct = s.total > 0 ? ((s.correct + s.incorrect) / s.total * 100) : 0;
  $progressBar.style.width = pct + '%';
}

/* ---- Rendering ---- */
function renderQuestion() {
  if (filtered.length === 0) {
    $questionContainer.style.display = 'none';
    $summaryContainer.style.display = 'none';
    $emptyState.style.display = 'block';
    updateScoreDisplay();
    return;
  }
  $emptyState.style.display = 'none';
  $summaryContainer.style.display = 'none';
  $questionContainer.style.display = 'block';

  var qi = filtered[currentIdx];
  var q = ALL_QUESTIONS[qi];

  // Counter
  $counter.textContent = 'Question ' + (currentIdx + 1) + ' of ' + filtered.length;

  // Meta tags
  $sectionLabel.textContent = getSection(q);
  var topic = getTopic(q);
  $topicLabel.textContent = topic;
  $topicLabel.style.display = topic ? '' : 'none';
  var diff = getDifficulty(q);
  $difficultyLabel.textContent = diff;
  $difficultyLabel.style.display = diff ? '' : 'none';

  // Image
  var imgUri = q._image_data_uri;
  if (imgUri) {
    $image.src = imgUri;
    $imageWrapper.style.display = 'block';
  } else {
    $imageWrapper.style.display = 'none';
    $image.src = '';
  }

  // Question text
  $text.innerHTML = escapeHtml(getQuestionText(q));

  // Choices
  var choices = getChoices(q);
  $choices.innerHTML = '';
  var isRevealed = !!revealed[qi];
  var selectedIdx = answers[qi];
  var correctIdx = getCorrectIndex(q);
  var letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';

  for (var i = 0; i < choices.length; i++) {
    var btn = document.createElement('button');
    btn.className = 'choice-btn';
    btn.setAttribute('data-idx', i);

    var letterSpan = document.createElement('span');
    letterSpan.className = 'choice-letter';
    letterSpan.textContent = (i < letters.length ? letters[i] : (i + 1)) + '.';

    var textSpan = document.createElement('span');
    textSpan.className = 'choice-text';
    textSpan.textContent = choices[i];

    btn.appendChild(letterSpan);
    btn.appendChild(textSpan);

    // Styling based on state
    if (isRevealed) {
      if (i === correctIdx) {
        btn.classList.add('choice-correct');
      }
      if (selectedIdx !== undefined && i === selectedIdx && i !== correctIdx) {
        btn.classList.add('choice-incorrect');
      }
      btn.disabled = true;
    } else if (selectedIdx !== undefined && i === selectedIdx) {
      btn.classList.add('choice-selected');
    }

    btn.addEventListener('click', (function(idx) {
      return function() { selectChoice(idx); };
    })(i));

    $choices.appendChild(btn);
  }

  // Feedback
  if (isRevealed) {
    $feedback.style.display = 'block';
    if (selectedIdx === correctIdx) {
      $feedbackText.textContent = 'Correct!';
      $feedbackText.className = 'feedback-correct';
    } else if (selectedIdx !== undefined && selectedIdx >= 0) {
      $feedbackText.textContent = 'Incorrect. The correct answer is ' + (correctIdx < letters.length ? letters[correctIdx] : (correctIdx + 1)) + '.';
      $feedbackText.className = 'feedback-incorrect';
    } else {
      $feedbackText.textContent = 'No answer selected. The correct answer is ' + (correctIdx < letters.length ? letters[correctIdx] : (correctIdx + 1)) + '.';
      $feedbackText.className = 'feedback-incorrect';
    }
    var expl = getExplanation(q);
    if (expl) {
      $explanation.style.display = 'block';
      $explanation.innerHTML = '<strong>Explanation:</strong> ' + escapeHtml(expl);
    } else {
      $explanation.style.display = 'none';
    }
    $btnShow.style.display = 'none';
  } else {
    $feedback.style.display = 'none';
    $explanation.style.display = 'none';
    $btnShow.style.display = '';
  }

  // Nav buttons
  $btnPrev.disabled = (currentIdx === 0);
  $btnNext.textContent = (currentIdx === filtered.length - 1) ? 'Finish' : 'Next \u2192';

  updateScoreDisplay();
}

function selectChoice(idx) {
  var qi = filtered[currentIdx];
  if (revealed[qi]) return;
  answers[qi] = idx;
  renderQuestion();
}

function revealAnswer() {
  var qi = filtered[currentIdx];
  revealed[qi] = true;
  if (answers[qi] === undefined) {
    answers[qi] = -1;
  }
  renderQuestion();
}

function goNext() {
  if (currentIdx < filtered.length - 1) {
    currentIdx++;
    renderQuestion();
    window.scrollTo(0, 0);
  } else {
    showSummary();
  }
}

function goPrev() {
  if (currentIdx > 0) {
    currentIdx--;
    renderQuestion();
    window.scrollTo(0, 0);
  }
}

/* ---- Summary ---- */
function showSummary() {
  $questionContainer.style.display = 'none';
  $emptyState.style.display = 'none';
  $summaryContainer.style.display = 'block';

  var s = calcScores();
  var pct = s.total > 0 ? Math.round(s.correct / s.total * 100) : 0;
  var passed = pct >= 83;  // CA DMV passing score

  document.getElementById('summary-score').innerHTML =
    '<div class="summary-big-score">' + s.correct + ' / ' + s.total + '</div>' +
    '<div class="summary-pct ' + (passed ? 'summary-pass' : 'summary-fail') + '">' + pct + '%' +
    (passed ? ' -- PASS' : ' -- NEEDS PRACTICE') + '</div>' +
    '<div class="summary-detail">' +
    '<span class="score-chip correct-chip">Correct: ' + s.correct + '</span> ' +
    '<span class="score-chip incorrect-chip">Incorrect: ' + s.incorrect + '</span> ' +
    '<span class="score-chip unanswered-chip">Unanswered: ' + s.unanswered + '</span>' +
    '</div>';

  // Breakdown by section
  var sectionStats = {};
  for (var i = 0; i < filtered.length; i++) {
    var qi = filtered[i];
    var q = ALL_QUESTIONS[qi];
    var sec = getSection(q);
    if (!sectionStats[sec]) sectionStats[sec] = { correct: 0, incorrect: 0, unanswered: 0, total: 0 };
    sectionStats[sec].total++;
    if (revealed[qi] && answers[qi] !== undefined) {
      if (answers[qi] === getCorrectIndex(q)) sectionStats[sec].correct++;
      else sectionStats[sec].incorrect++;
    } else {
      sectionStats[sec].unanswered++;
    }
  }
  var bhtml = '<h3>Breakdown by Section</h3><table class="breakdown-table"><thead><tr><th>Section</th><th>Correct</th><th>Incorrect</th><th>Unanswered</th><th>Score</th></tr></thead><tbody>';
  var skeys = Object.keys(sectionStats).sort();
  for (var j = 0; j < skeys.length; j++) {
    var st = sectionStats[skeys[j]];
    var sp = st.total > 0 ? Math.round(st.correct / st.total * 100) : 0;
    bhtml += '<tr><td>' + escapeHtml(skeys[j]) + '</td><td>' + st.correct + '</td><td>' + st.incorrect + '</td><td>' + st.unanswered + '</td><td>' + sp + '%</td></tr>';
  }
  bhtml += '</tbody></table>';
  document.getElementById('summary-breakdown').innerHTML = bhtml;

  updateScoreDisplay();
}

/* ---- Main view toggle ---- */
function updateView() {
  renderQuestion();
}

/* ---- Reset ---- */
function resetAll() {
  answers = {};
  revealed = {};
  currentIdx = 0;
  updateView();
}

/* ---- Event listeners ---- */
$btnShow.addEventListener('click', revealAnswer);
$btnNext.addEventListener('click', goNext);
$btnPrev.addEventListener('click', goPrev);
$filterSection.addEventListener('change', applyFilters);
$filterTopic.addEventListener('change', applyFilters);
$filterDifficulty.addEventListener('change', applyFilters);
$filterType.addEventListener('change', applyFilters);
$btnShuffle.addEventListener('click', function() {
  shuffleArray(filtered);
  currentIdx = 0;
  updateView();
});
$btnReset.addEventListener('click', resetAll);
document.getElementById('btn-review').addEventListener('click', function() {
  currentIdx = 0;
  $summaryContainer.style.display = 'none';
  $questionContainer.style.display = 'block';
  renderQuestion();
});
document.getElementById('btn-restart').addEventListener('click', function() {
  resetAll();
  $summaryContainer.style.display = 'none';
});

// Keyboard navigation
document.addEventListener('keydown', function(e) {
  if ($summaryContainer.style.display !== 'none') return;
  if ($questionContainer.style.display === 'none') return;
  if (e.key === 'ArrowRight' || e.key === 'n') goNext();
  else if (e.key === 'ArrowLeft' || e.key === 'p') goPrev();
  else if (e.key === 'Enter' || e.key === ' ') {
    var qi = filtered[currentIdx];
    if (!revealed[qi]) { e.preventDefault(); revealAnswer(); }
  }
  else if (e.key >= '1' && e.key <= '9') {
    var ci = parseInt(e.key, 10) - 1;
    var qi2 = filtered[currentIdx];
    if (!revealed[qi2] && ci < getChoices(ALL_QUESTIONS[qi2]).length) selectChoice(ci);
  }
  else if (e.key >= 'a' && e.key <= 'z' && e.key.length === 1) {
    var ci2 = e.key.charCodeAt(0) - 97;
    var qi3 = filtered[currentIdx];
    if (!revealed[qi3] && ci2 < getChoices(ALL_QUESTIONS[qi3]).length) selectChoice(ci2);
  }
});

/* ---- Init ---- */
populateFilters();
applyFilters();

})();
</script>
</body>
</html>